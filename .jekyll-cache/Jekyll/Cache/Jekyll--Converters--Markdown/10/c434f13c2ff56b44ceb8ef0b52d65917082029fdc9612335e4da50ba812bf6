I"Ò<blockquote>
  <p>ç”±äºå·¥ä½œä¸­éœ€è¦å†™ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ç±»åº“ï¼Œè¿™ä¸ªç±»åº“éœ€è¦å¾ˆé«˜çš„æ‰©å±•æ€§ã€ç»´æŠ¤æ€§åŠå¤ç”¨æ€§ã€‚ä¸ºäº†éº»çƒ¦ç°åœ¨ç®€å•æœªæ¥ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼æ€æƒ³æ¥ä¼˜åŒ–ç±»åº“å¯ä»¥ä½¿å·¥ä½œäº‹åŠåŠŸå€ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹å„ç§è®¾è®¡æ¨¡å¼ï¼Œæ€»ç»“ä¸€ä¸‹çŸ¥è¯†ï¼Œé¡ºä¾¿ä¹Ÿå¯ä»¥åšä¸ºè‡ªå·±æ—¥åçš„å‚è€ƒã€‚</p>
</blockquote>

<h2 id="è®¾è®¡æ¨¡å¼design-patterns">è®¾è®¡æ¨¡å¼ï¼ˆDesign Patternsï¼‰</h2>

<blockquote>
  <p>è®¾è®¡æ¨¡å¼ï¼ˆDesign patternï¼‰æ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚ä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£ã€ä¿è¯ä»£ç å¯é æ€§ã€‚   â€“<a href="http://baike.baidu.com/view/66964.htm">ç™¾åº¦ç™¾ç§‘</a></p>
</blockquote>

<blockquote>
  <p>In software engineering, a design pattern is a general reusable solution to a commonly occurring problem within a given context in software design.   â€“<a href="http://en.wikipedia.org/wiki/Software_design_pattern">Wikipedia</a></p>
</blockquote>

<p>åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªåŠŸèƒ½çš„å®ç°æ–¹å¼å¤šç§å¤šæ ·ï¼Œä¸åŒæ–¹æ³•çš„å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ä»¥åŠå¤ç”¨æ€§éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚éšç€ä¸€ä¸ªäººå¯¹è‡ªå·±é¡¹ç›®ä»£ç çš„è¦æ±‚å¢åŠ ï¼Œä»–ä¼šé€æ¸æ€è€ƒå’Œå®è·µå‡ºè‡ªå·±çš„ä¸€å¥—æ–¹æ³•æˆ–è€…æ€æƒ³ï¼Œè¿™ç§æ–¹æ³•æˆ–æ€æƒ³å†³å®šäº†ä»–è®¾è®¡å‡ºçš„æ¶æ„æˆ–è€…ç¼–å†™å‡ºçš„ä»£ç çš„è´¨é‡ä¼˜åŠ£ã€‚è®¾è®¡æ¨¡å¼å°±å±äºè¿™æ ·ä¸€ç§ç»éªŒçš„ç§¯ç´¯ï¼Œæ˜¯ç”±å¤§é‡ä¼˜ç§€çš„å·¥ç¨‹å¸ˆæˆ–è€…æ¶æ„å¸ˆæ€»ç»“å’Œæç‚¼çš„ç²¾åï¼Œå­¦ä¹ å¥½è®¾è®¡æ¨¡å¼ç­‰äºè®©æˆ‘ä»¬ç«™åœ¨äº†å·¨äººçš„è‚©è†€ä¸Šï¼Œä»ä¸€ä¸ªé«˜çš„èµ·ç‚¹å‡ºå‘ï¼Œå¯ä»¥é¿å…èµ°å¾ˆå¤šå¼¯è·¯ã€‚</p>

<p>è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ä¸€å®šæ˜¯æ ¹æ®åœºæ™¯æ¥é€‰æ‹©çš„ï¼Œè€Œä¸”è®¾è®¡æ¨¡å¼çš„å®ç°æ–¹å¼ä¹Ÿä¸æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬ä¸€å®šè¦åœ¨ç†è§£ç°æœ‰è®¾è®¡æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®è‡ªå·±å®é™…çš„æƒ…å†µä¸æ–­å®è·µä¸æ–­ç†è§£ã€‚å°±åƒæ‰€è°“çš„ã€Šæ³¡å¦å¤§å…¨ã€‹ï¼Œè¯»åƒä¸‡ééƒ½ä¸å¦‚å®è·µä¸€æ¬¡æ¥çš„å®é™…ã€‚</p>

<p>å¦‚æœä½ å¯¹è®¾è®¡æ¨¡å¼å®Œå…¨æ²¡æœ‰æ„Ÿè§‰ï¼Œé‚£ä¹ˆå»å¥½å¥½å†™ä¸€ä¸ªç±»åº“ï¼Œæˆ–è€…ä¸€ä¸ªç®€å•çš„MVCæ¡†æ¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šè®©ä½ æ„Ÿè§‰åˆ°è‡ªå·±ç¼ºå¤±çš„éƒ¨åˆ†ã€‚</p>

<h3 id="åˆ†ç±»">åˆ†ç±»</h3>
<p>åœ¨ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹(Design Patterns: Elements of Reusable Object-Oriented Software) è¿™æœ¬ä¹¦ä¸­ï¼Œä½œè€…æŠŠè®¾è®¡æ¨¡å¼åˆ†äº†ä¸‰å¤§ç±»ï¼š</p>

<h4 id="åˆ›å»ºå‹æ¨¡å¼creational-patterns">åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational patternsï¼‰</h4>
<p><a href="http://en.wikipedia.org/wiki/Creational_pattern">åˆ›å»ºå‹æ¨¡å¼</a>æ˜¯ä¸ºäº†è§£å†³åˆ›å»ºå¯¹è±¡æ—¶å€™é‡åˆ°çš„é—®é¢˜ã€‚å› ä¸ºåŸºæœ¬çš„å¯¹è±¡åˆ›å»ºæ–¹å¼å¯èƒ½ä¼šå¯¼è‡´è®¾è®¡ä¸Šçš„é—®é¢˜ï¼Œæˆ–å¢åŠ è®¾è®¡çš„å¤æ‚åº¦ã€‚åˆ›å»ºå‹æ¨¡å¼æœ‰ä¸¤ä¸ªä¸»å¯¼æ€æƒ³ï¼šä¸€æ˜¯å°†ç³»ç»Ÿä½¿ç”¨çš„å…·ä½“ç±»å°è£…èµ·æ¥ï¼ŒäºŒæ˜¯éšè—è¿™äº›å…·ä½“ç±»çš„å®ä¾‹åˆ›å»ºå’Œç»“åˆæ–¹å¼ã€‚</p>

<p>æœ€å¸¸è§çš„äº”ç§åˆ›å»ºå‹æ¨¡å¼å¦‚ä¸‹ï¼š</p>

<ul>
  <li>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory method pattern)</li>
  <li>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract factory pattern)</li>
  <li>å•ä¾‹æ¨¡å¼ï¼ˆSingleton patternï¼‰</li>
  <li>å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder patternï¼‰</li>
  <li>åŸå‹æ¨¡å¼ï¼ˆPrototype patternï¼‰</li>
</ul>

<h4 id="ç»“æ„å‹æ¨¡å¼structural-pattern">ç»“æ„å‹æ¨¡å¼ï¼ˆStructural patternï¼‰</h4>
<p><a href="http://en.wikipedia.org/wiki/Structural_pattern">ç»“æ„å‹æ¨¡å¼</a>æ˜¯é€šè¿‡å®šä¹‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥å®ç°å’Œäº†è§£å®ä½“é—´å…³ç³»ï¼Œä»è€Œç®€åŒ–è®¾è®¡ã€‚</p>

<ul>
  <li>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter patternï¼‰</li>
  <li>æ¡¥æ¥æ¨¡å¼ï¼ˆBridge patternï¼‰</li>
  <li>åˆæˆæ¨¡å¼ï¼ˆComposite patternï¼‰</li>
  <li>è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator patternï¼‰</li>
  <li>é—¨é¢æ¨¡å¼ï¼ˆFacade patternï¼‰</li>
  <li>ä»£ç†æ¨¡å¼ï¼ˆProxy patternï¼‰</li>
  <li>äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰</li>
</ul>

<h4 id="è¡Œä¸ºå‹æ¨¡å¼behavioral-pattern">è¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral patternï¼‰</h4>
<p><a href="http://en.wikipedia.org/wiki/Behavioral_pattern">è¡Œä¸ºå‹æ¨¡å¼</a>ç”¨æ¥è¯†åˆ«å¯¹è±¡ä¹‹é—´çš„å¸¸ç”¨äº¤æµæ¨¡å¼å¹¶åŠ ä»¥å®ç°ï¼Œä½¿å¾—äº¤æµå˜å¾—æ›´åŠ çµæ´»ã€‚</p>

<ul>
  <li>ç­–ç•¥æ¨¡å¼ï¼ˆStrategy patternï¼‰</li>
  <li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate method patternï¼‰</li>
  <li>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver patternï¼‰</li>
  <li>è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator patternï¼‰</li>
  <li>è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of responsibility patternï¼‰</li>
  <li>å‘½ä»¤æ¨¡å¼ï¼ˆCommand patternï¼‰</li>
  <li>å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento patternï¼‰</li>
  <li>çŠ¶æ€æ¨¡å¼ï¼ˆState patternï¼‰</li>
  <li>è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor patternï¼‰</li>
  <li>ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator patternï¼‰</li>
  <li>è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreter patternï¼‰</li>
</ul>

<h3 id="å…³ç³»">å…³ç³»</h3>
<p>è¿™é‡Œæœ‰ä¸€å¼ å„ä¸ªæ¨¡å¼å…³ç³»å›¾ï¼Œå¯ä»¥åœ¨äº†è§£å„ä¸ªæ¨¡å¼ä»¥åæ¢³ç†ä¸€ä¸‹</p>

<p><img src="http://imgs.yansu.org/tech-design-patterns.jpg" alt="è®¾è®¡æ¨¡å¼" /></p>

<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Software_design_pattern">Wikipedia: Software design pattern</a></li>
  <li><a href="http://baike.baidu.com/view/66964.htm">ç™¾åº¦ç™¾ç§‘ï¼šè®¾è®¡æ¨¡å¼</a></li>
</ol>

<h2 id="å»ºé€ è€…æ¨¡å¼builder-pattern">å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder patternï¼‰</h2>
<p>å»ºé€ è€…æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒå¯ä»¥è®©ä¸€ä¸ªäº§å“çš„å†…éƒ¨è¡¨è±¡å’Œå’Œäº§å“çš„ç”Ÿäº§è¿‡ç¨‹åˆ†ç¦»å¼€ï¼Œä»è€Œå¯ä»¥ç”Ÿæˆå…·æœ‰ä¸åŒå†…éƒ¨è¡¨è±¡çš„äº§å“ã€‚</p>

<h3 id="builderæ¨¡å¼ä¸­ä¸»è¦è§’è‰²">Builderæ¨¡å¼ä¸­ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡å»ºé€ è€…(Builder)è§’è‰²ï¼šå®šä¹‰æŠ½è±¡æ¥å£ï¼Œè§„èŒƒäº§å“å„ä¸ªéƒ¨åˆ†çš„å»ºé€ ï¼Œå¿…é¡»åŒ…æ‹¬å»ºé€ æ–¹æ³•å’Œè¿”å›æ–¹æ³•ã€‚</li>
  <li>å…·ä½“å»ºé€ è€…(Concrete)è§’è‰²ï¼šå®ç°æŠ½è±¡å»ºé€ è€…æ¥å£ã€‚åº”ç”¨ç¨‹åºæœ€ç»ˆæ ¹æ®æ­¤è§’è‰²ä¸­å®ç°çš„ä¸šåŠ¡é€»è¾‘åˆ›é€ äº§å“ã€‚</li>
  <li>å¯¼æ¼”è€…(Director)è§’è‰²ï¼šè°ƒç”¨å…·ä½“çš„å»ºé€ è€…è§’è‰²åˆ›é€ äº§å“ã€‚</li>
  <li>äº§å“(Product)è§’è‰²ï¼šåœ¨å¯¼æ¼”è€…çš„æŒ‡å¯¼ä¸‹æ‰€åˆ›å»ºçš„å¤æ‚å¯¹è±¡ã€‚</li>
</ul>

<h3 id="é€‚ç”¨æ€§">é€‚ç”¨æ€§</h3>

<ul>
  <li>å½“åˆ›å»ºå¤æ‚å¯¹è±¡çš„ç®—æ³•åº”è¯¥ç‹¬ç«‹äºè¯¥å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ä»¥åŠå®ƒä»¬çš„è£…é…æ–¹å¼æ—¶ã€‚</li>
  <li>å½“æ„é€ è¿‡ç¨‹å¿…é¡»å…è®¸è¢«æ„é€ çš„å¯¹è±¡æœ‰ä¸åŒçš„è¡¨ç¤ºæ—¶ã€‚</li>
</ul>

<h3 id="ç±»å›¾">ç±»å›¾</h3>
<p><img src="http://imgs.yansu.org/tech-builder-pattern-uml.png" alt="builder pattern" /></p>

<h3 id="å®ä¾‹">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kd">class</span> <span class="nc">Product</span> <span class="p">{</span> <span class="c1">// äº§å“æœ¬èº«</span>
    <span class="k">private</span> <span class="nv">$_parts</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_parts</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nv">$part</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">array_push</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_parts</span><span class="p">,</span> <span class="nv">$part</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="p">{</span> <span class="c1">// å»ºé€ è€…æŠ½è±¡ç±»</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">function</span> <span class="nf">buildPart1</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">function</span> <span class="nf">buildPart2</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">function</span> <span class="nf">getResult</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteBuilder</span> <span class="k">extends</span> <span class="nx">Builder</span> <span class="p">{</span> <span class="c1">// å…·ä½“å»ºé€ è€…</span>
    <span class="k">private</span> <span class="nv">$_product</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_product</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Product</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildPart1</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_product</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">"Part1"</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildPart2</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_product</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s2">"Part2"</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getResult</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_product</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Director</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Builder</span> <span class="nv">$builder</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">buildPart1</span><span class="p">();</span>
        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">buildPart2</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$buidler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteBuilder</span><span class="p">();</span>
<span class="nv">$director</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Director</span><span class="p">(</span><span class="nv">$buidler</span><span class="p">);</span>
<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$buidler</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h4>
<p>å»ºé€ è€…æ¨¡å¼å¯ä»¥å¾ˆå¥½çš„å°†ä¸€ä¸ªå¯¹è±¡çš„å®ç°ä¸ç›¸å…³çš„â€œä¸šåŠ¡â€é€»è¾‘åˆ†ç¦»å¼€æ¥ï¼Œä»è€Œå¯ä»¥åœ¨ä¸æ”¹å˜äº‹ä»¶é€»è¾‘çš„å‰æä¸‹ï¼Œä½¿å¢åŠ (æˆ–æ”¹å˜)å®ç°å˜å¾—éå¸¸å®¹æ˜“ã€‚</p>

<h4 id="ç¼ºç‚¹">ç¼ºç‚¹</h4>
<p>å»ºé€ è€…æ¥å£çš„ä¿®æ”¹ä¼šå¯¼è‡´æ‰€æœ‰æ‰§è¡Œç±»çš„ä¿®æ”¹ã€‚</p>

<h3 id="å‚è€ƒ-1">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Builder_pattern">Wikipedia: Bulider pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F">Wikipedia: ç”Ÿæˆå™¨æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/05/php-design-pattern-2-builder/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°å»ºé€ è€…æ¨¡å¼</a></li>
</ol>

<h2 id="å•ä¾‹æ¨¡å¼singleton-pattern">å•ä¾‹æ¨¡å¼ï¼ˆSingleton patternï¼‰</h2>
<p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹æ¨¡å¼ï¼Œåœ¨åº”ç”¨è¿™ä¸ªæ¨¡å¼æ—¶ï¼Œå•ä¾‹å¯¹è±¡çš„ç±»å¿…é¡»ä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚</p>

<p>å®ç°å•ä¾‹æ¨¡å¼çš„æ€è·¯æ˜¯ï¼šä¸€ä¸ªç±»èƒ½è¿”å›å¯¹è±¡ä¸€ä¸ªå¼•ç”¨(æ°¸è¿œæ˜¯åŒä¸€ä¸ª)å’Œä¸€ä¸ªè·å¾—è¯¥å®ä¾‹çš„æ–¹æ³•ï¼ˆå¿…é¡»æ˜¯é™æ€æ–¹æ³•ï¼Œé€šå¸¸ä½¿ç”¨getInstanceè¿™ä¸ªåç§°ï¼‰ï¼›å½“æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå¦‚æœç±»æŒæœ‰çš„å¼•ç”¨ä¸ä¸ºç©ºå°±è¿”å›è¿™ä¸ªå¼•ç”¨ï¼Œå¦‚æœç±»ä¿æŒçš„å¼•ç”¨ä¸ºç©ºå°±åˆ›å»ºè¯¥ç±»çš„å®ä¾‹å¹¶å°†å®ä¾‹çš„å¼•ç”¨èµ‹äºˆè¯¥ç±»ä¿æŒçš„å¼•ç”¨ï¼›åŒæ—¶æˆ‘ä»¬è¿˜å°†è¯¥ç±»çš„æ„é€ å‡½æ•°å®šä¹‰ä¸ºç§æœ‰æ–¹æ³•ï¼Œè¿™æ ·å…¶ä»–å¤„çš„ä»£ç å°±æ— æ³•é€šè¿‡è°ƒç”¨è¯¥ç±»çš„æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ï¼Œåªæœ‰é€šè¿‡è¯¥ç±»æä¾›çš„é™æ€æ–¹æ³•æ¥å¾—åˆ°è¯¥ç±»çš„å”¯ä¸€å®ä¾‹ã€‚</p>

<h3 id="å•ä¾‹æ¨¡å¼ä¸­ä¸»è¦è§’è‰²">å•ä¾‹æ¨¡å¼ä¸­ä¸»è¦è§’è‰²</h3>
<p>Singletonå®šä¹‰ä¸€ä¸ªgetInstanceæ“ä½œï¼Œå…è®¸å®¢æˆ·è®¿é—®å®ƒå”¯ä¸€çš„å®ä¾‹ã€‚</p>

<p>è¿™ä¸ªä¾‹å­ä¹Ÿç®€å•ï¼Œå°±åƒæˆ‘æœ‰6ä¸ªè€å©†ï¼ˆå¿«é†’é†’!ï¼‰ï¼Œå¥¹ä»¬åœ¨å–Šâ€è€å…¬â€çš„æ—¶å€™éƒ½æ˜¯æŒ‡æˆ‘ã€‚ä¸ç®¡ä»€ä¹ˆæ—¶å€™ï¼Œå–Šè€å…¬æ“¦åœ°ï¼Œåšé¥­ï¼Œæ´—è¡£æœéƒ½æ˜¯æŒ‡åŒä¸€ä¸ªäººï¼ŒPHPä¸ç¼–å†™å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æŠ¢å é—®é¢˜ï¼Œå¦‚æœæ¢åˆ«çš„è¯­è¨€ç¼–å†™ï¼Œä¸€å®šå¾—è€ƒè™‘åˆ°æŠ¢å é—®é¢˜ï¼è€å…¬æ˜¯ä¸å¯ä»¥è¾¹æ“¦åœ°è¾¹åšé¥­çš„ï¼</p>

<h3 id="é€‚ç”¨æ€§-1">é€‚ç”¨æ€§</h3>

<ul>
  <li>å½“ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹è€Œä¸”å®¢æˆ·å¯ä»¥ä»ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„è®¿é—®ç‚¹è®¿é—®å®ƒæ—¶</li>
  <li>å½“è¿™ä¸ªå”¯ä¸€å®ä¾‹åº”è¯¥æ˜¯é€šè¿‡å­ç±»åŒ–å¯æ‰©å±•çš„ã€‚å¹¶ä¸”ç”¨æˆ·åº”è¯¥æ— éœ€æ›´æ”¹ä»£ç å°±èƒ½ä½¿ç”¨ä¸€ä¸ªæ‰©å±•çš„å®ä¾‹æ—¶ã€‚</li>
</ul>

<h3 id="ç±»å›¾-1">ç±»å›¾</h3>
<p><img src="http://imgs.yansu.org/tech-singleton-pattern-uml.png" alt="singleton pattern" /></p>

<h3 id="å®ä¾‹-1">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">public</span> <span class="kd">class</span> <span class="nc">Singleton</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="nv">$_instance</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>

    <span class="c1">// ç§æœ‰æ„é€ æ–¹æ³•</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getInstance</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$_instance</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">self</span><span class="o">::</span><span class="nv">$_instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Singleton</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$_instance</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// é˜²æ­¢å…‹éš†å®ä¾‹</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__clone</span><span class="p">(){</span>
        <span class="k">die</span><span class="p">(</span><span class="s1">'Clone is not allowed.'</span> <span class="o">.</span> <span class="nx">E_USER_ERROR</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>åœ¨æ­¤å®ä¾‹ä¸­ï¼ŒSingletonç¦æ­¢äº†å…‹éš†åŠå¤–éƒ¨åˆå§‹åŒ–ï¼Œä½¿å¾—æ­¤ç±»åªå¯ä»¥é€šè¿‡<code class="highlighter-rouge">getInstance()</code>æ–¹æ³•æ¥è·å¾—å®ä¾‹ï¼Œè€Œè¿™ä¸ªå®ä¾‹åªä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åˆ›å»ºï¼Œä»¥åæ¯æ¬¡éƒ½è·å¾—åŒä¸€å®ä¾‹ã€‚</p>

<h3 id="ä¼˜ç¼ºç‚¹-1">ä¼˜ç¼ºç‚¹</h3>
<h4 id="ä¼˜ç‚¹-1">ä¼˜ç‚¹</h4>
<ul>
  <li>å¯¹å”¯ä¸€å®ä¾‹çš„å—æ§è®¿é—®</li>
  <li>ç¼©å°å‘½åç©ºé—´ å•ä¾‹æ¨¡å¼æ˜¯å¯¹å…¨å±€å˜é‡çš„ä¸€ç§æ”¹è¿›ã€‚å®ƒé¿å…äº†é‚£äº›å­˜å‚¨å”¯ä¸€å®ä¾‹çš„å…¨å±€å˜é‡æ±¡æŸ“å‘½åç©ºé—´</li>
  <li>å…è®¸å¯¹æ“ä½œå’Œè¡¨ç¤ºçš„ç²¾åï¼Œå•ä¾‹ç±»å¯ä»¥æœ‰å­ç±»ã€‚è€Œä¸”ç”¨è¿™ä¸ªæ‰©å±•ç±»çš„å®ä¾‹æ¥é…ç½®ä¸€ä¸ªåº”ç”¨æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä½ å¯ä»¥ç”¨ä½ æ‰€éœ€è¦çš„ç±»çš„å®ä¾‹åœ¨è¿è¡Œæ—¶åˆ»é…ç½®åº”ç”¨ã€‚</li>
  <li>å…è®¸å¯å˜æ•°ç›®çš„å®ä¾‹ï¼ˆå¤šä¾‹æ¨¡å¼ï¼‰</li>
  <li>æ¯”ç±»æ“ä½œæ›´çµæ´»</li>
</ul>

<h4 id="ç¼ºç‚¹-1">ç¼ºç‚¹</h4>
<p>å•ä¾‹æ¨¡å¼åœ¨å¤šçº¿ç¨‹çš„åº”ç”¨åœºåˆä¸‹å¿…é¡»å°å¿ƒä½¿ç”¨ã€‚å¦‚æœå½“å”¯ä¸€å®ä¾‹å°šæœªåˆ›å»ºæ—¶ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨åˆ›å»ºæ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä»¬åŒæ—¶æ²¡æœ‰æ£€æµ‹åˆ°å”¯ä¸€å®ä¾‹çš„å­˜åœ¨ï¼Œä»è€ŒåŒæ—¶å„è‡ªåˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹ï¼Œè¿™æ ·å°±æœ‰ä¸¤ä¸ªå®ä¾‹è¢«æ„é€ å‡ºæ¥ï¼Œä»è€Œè¿åäº†å•ä¾‹æ¨¡å¼ä¸­å®ä¾‹å”¯ä¸€çš„åŸåˆ™ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯ä¸ºæŒ‡ç¤ºç±»æ˜¯å¦å·²ç»å®ä¾‹åŒ–çš„å˜é‡æä¾›ä¸€ä¸ªäº’æ–¥é”(è™½ç„¶è¿™æ ·ä¼šé™ä½æ•ˆç‡)ã€‚</p>

<h3 id="å‚è€ƒ-2">å‚è€ƒ</h3>
<ol>
  <li><a href="http://zh.wikipedia.org/wiki/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">Wikipedia: å•ä¾‹æ¨¡å¼</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Singleton_pattern">Wikipedia: Singleton pattern</a></li>
  <li><a href="http://www.phppan.com/2010/06/php-design-pattern-6-singleton/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°å•ä¾‹æ¨¡å¼</a></li>
</ol>

<h2 id="é€‚é…å™¨æ¨¡å¼adapter-pattern">é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter patternï¼‰</h2>
<p>é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹æ¨¡å¼ï¼Œå®ƒå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¥æˆç”¨æˆ·æ‰€æœŸå¾…çš„ã€‚ä¸€ä¸ªé€‚é…ä½¿å¾—å› æ¥å£ä¸å…¼å®¹è€Œä¸èƒ½åœ¨ä¸€èµ·å·¥ä½œçš„ç±»å·¥ä½œåœ¨ä¸€èµ·ï¼Œåšæ³•æ˜¯å°†ç±»åˆ«è‡ªå·±çš„æ¥å£åŒ…è£¹åœ¨ä¸€ä¸ªå·²å­˜åœ¨çš„ç±»ä¸­ã€‚</p>

<h3 id="é€‚é…å™¨æ¨¡å¼ä¸­ä¸»è¦è§’è‰²">é€‚é…å™¨æ¨¡å¼ä¸­ä¸»è¦è§’è‰²</h3>

<ul>
  <li>ç›®æ ‡(Target)è§’è‰²ï¼šå®šä¹‰å®¢æˆ·ç«¯ä½¿ç”¨çš„ä¸ç‰¹å®šé¢†åŸŸç›¸å…³çš„æ¥å£ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€æœŸå¾…å¾—åˆ°çš„</li>
  <li>æº(Adaptee)è§’è‰²ï¼šéœ€è¦è¿›è¡Œé€‚é…çš„æ¥å£</li>
  <li>é€‚é…å™¨(Adapter)è§’è‰²ï¼šå¯¹Adapteeçš„æ¥å£ä¸Targetæ¥å£è¿›è¡Œé€‚é…ï¼›é€‚é…å™¨æ˜¯æœ¬æ¨¡å¼çš„æ ¸å¿ƒï¼Œé€‚é…å™¨æŠŠæºæ¥å£è½¬æ¢æˆç›®æ ‡æ¥å£ï¼Œæ­¤è§’è‰²ä¸ºå…·ä½“ç±»</li>
</ul>

<h3 id="é€‚ç”¨æ€§-2">é€‚ç”¨æ€§</h3>
<p>1ã€ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç±»ï¼Œè€Œå®ƒçš„æ¥å£ä¸ç¬¦åˆä½ çš„éœ€æ±‚
2ã€ä½ æƒ³åˆ›å»ºä¸€ä¸ªå¯ä»¥å¤ç”¨çš„ç±»ï¼Œè¯¥ç±»å¯ä»¥ä¸å…¶ä»–ä¸ç›¸å…³çš„ç±»æˆ–ä¸å¯é¢„è§çš„ç±»ååŒå·¥ä½œ
3ã€ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å­ç±»ï¼Œä½†æ˜¯ä¸å¯èƒ½å¯¹æ¯ä¸€ä¸ªéƒ½è¿›è¡Œå­ç±»åŒ–ä»¥åŒ¹é…å®ƒä»¬çš„æ¥å£ã€‚å¯¹è±¡é€‚é…å™¨å¯ä»¥é€‚é…å®ƒçš„çˆ¶ç±»æ¥å£ï¼ˆä»…é™äºå¯¹è±¡é€‚é…å™¨ï¼‰</p>

<h3 id="ç±»é€‚é…å™¨æ¨¡å¼ä¸å¯¹è±¡é€‚é…å™¨">ç±»é€‚é…å™¨æ¨¡å¼ä¸å¯¹è±¡é€‚é…å™¨</h3>

<p>ç±»é€‚é…å™¨ï¼šAdapterä¸Adapteeæ˜¯ç»§æ‰¿å…³ç³»</p>

<ul>
  <li>ç”¨ä¸€ä¸ªå…·ä½“çš„Adapterç±»å’ŒTargetè¿›è¡ŒåŒ¹é…ã€‚ç»“æœæ˜¯å½“æˆ‘ä»¬æƒ³è¦ä¸€ä¸ªåŒ¹é…ä¸€ä¸ªç±»ä»¥åŠæ‰€æœ‰å®ƒçš„å­ç±»æ—¶ï¼Œç±»Adapterå°†ä¸èƒ½èƒœä»»å·¥ä½œ</li>
  <li>ä½¿å¾—Adapterå¯ä»¥é‡å®šä¹‰Adapteeçš„éƒ¨åˆ†è¡Œä¸ºï¼Œå› ä¸ºAdapteræ˜¯Adapteeçš„ä¸€ä¸ªå­é›†</li>
  <li>ä»…ä»…å¼•å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸éœ€è¦é¢å¤–çš„æŒ‡é’ˆä»¥é—´æ¥å–å¾—adaptee</li>
</ul>

<p>å¯¹è±¡é€‚é…å™¨ï¼šAdapterä¸Adapteeæ˜¯å§”æ‰˜å…³ç³»</p>

<ul>
  <li>å…è®¸ä¸€ä¸ªAdapterä¸å¤šä¸ªAdapteeåŒæ—¶å·¥ä½œã€‚Adapterä¹Ÿå¯ä»¥ä¸€æ¬¡ç»™æ‰€æœ‰çš„Adapteeæ·»åŠ åŠŸèƒ½</li>
  <li>ä½¿ç”¨é‡å®šä¹‰Adapteeçš„è¡Œä¸ºæ¯”è¾ƒå›°éš¾</li>
</ul>

<h3 id="ç±»å›¾-2">ç±»å›¾</h3>

<h4 id="ç±»é€‚é…å™¨">ç±»é€‚é…å™¨</h4>
<p><img src="http://imgs.yansu.org/tech-class-adapter-pattern-uml.jpg" alt="class adapter pattern" /></p>

<h4 id="å¯¹è±¡é€‚é…å™¨">å¯¹è±¡é€‚é…å™¨</h4>
<p><img src="http://imgs.yansu.org/tech-object-adapter-pattern-uml.jpg" alt="object adapter pattern" /></p>

<h3 id="å®ä¾‹-2">å®ä¾‹</h3>

<h4 id="ç±»é€‚é…å™¨-1">ç±»é€‚é…å™¨</h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kd">interface</span> <span class="nc">Target</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sampleMethod1</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sampleMethod2</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Adaptee</span> <span class="p">{</span> <span class="c1">// æºè§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sampleMethod1</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Adapter</span> <span class="k">extends</span> <span class="nx">Adaptee</span> <span class="k">implements</span> <span class="nx">Target</span> <span class="p">{</span> <span class="c1">// é€‚é…åè§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sampleMethod2</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Adapter</span><span class="p">();</span>
<span class="nv">$adapter</span><span class="o">-&gt;</span><span class="na">sampleMethod1</span><span class="p">();</span>
<span class="nv">$adapter</span><span class="o">-&gt;</span><span class="na">sampleMethod2</span><span class="p">();</span>

<span class="cp">?&gt;</span>
</code></pre></div></div>

<h4 id="å¯¹è±¡é€‚é…å™¨-1">å¯¹è±¡é€‚é…å™¨</h4>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kd">interface</span> <span class="nc">Target</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sampleMethod1</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sampleMethod2</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Adaptee</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">sampleMethod1</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Adapter</span> <span class="k">implements</span> <span class="nx">Target</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$_adaptee</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Adaptee</span> <span class="nv">$adaptee</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_adaptee</span> <span class="o">=</span> <span class="nv">$adaptee</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">sampleMethod1</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_adaptee</span><span class="o">-&gt;</span><span class="na">sampleMethod1</span><span class="p">();</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">sampleMethod2</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="nv">$adaptee</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Adaptee</span><span class="p">();</span>
<span class="nv">$adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Adapter</span><span class="p">(</span><span class="nv">$adaptee</span><span class="p">);</span>
<span class="nv">$adapter</span><span class="o">-&gt;</span><span class="na">sampleMethod1</span><span class="p">();</span>
<span class="nv">$adapter</span><span class="o">-&gt;</span><span class="na">sampleMethod2</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="å‚è€ƒ-3">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Adapter_pattern">Wikipedia: Adapter pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F">Wikipedia: é€‚é…å™¨æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/07/php-design-pattern-10-adapter/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°é€‚é…å™¨æ¨¡å¼</a></li>
</ol>

<h2 id="æ¡¥æ¥æ¨¡å¼bridge-pattern">æ¡¥æ¥æ¨¡å¼ï¼ˆBridge patternï¼‰</h2>
<p>æ¡¥æ¥æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹æ¨¡å¼ï¼Œå®ƒæ˜¯è½¯ä»¶è®¾è®¡æ¨¡å¼ä¸­æœ€å¤æ‚çš„æ¨¡å¼ä¹‹ä¸€ï¼Œå®ƒæŠŠäº‹ç‰©å¯¹è±¡å’Œå…¶å…·ä½“è¡Œä¸ºã€å…·ä½“ç‰¹å¾åˆ†ç¦»å¼€æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥å„è‡ªç‹¬ç«‹çš„å˜åŒ–ã€‚äº‹ç‰©å¯¹è±¡ä»…æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µã€‚å¦‚â€œåœ†å½¢â€ã€â€œä¸‰è§’å½¢â€å½’äºæŠ½è±¡çš„â€œå½¢çŠ¶â€ä¹‹ä¸‹ï¼Œè€Œâ€œç”»åœ†â€ã€â€œç”»ä¸‰è§’â€å½’äºå®ç°è¡Œä¸ºçš„â€œç”»å›¾â€ç±»ä¹‹ä¸‹ï¼Œç„¶åç”±â€œå½¢çŠ¶â€è°ƒç”¨â€œç”»å›¾â€ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡åŒ–(Abstraction)è§’è‰²ï¼šå®šä¹‰æŠ½è±¡ç±»çš„æ¥å£å¹¶ä¿å­˜ä¸€ä¸ªå¯¹å®ç°åŒ–å¯¹è±¡çš„å¼•ç”¨ã€‚</li>
  <li>ä¿®æ­£æŠ½è±¡åŒ–(Refined Abstraction)è§’è‰²ï¼šæ‰©å±•æŠ½è±¡åŒ–è§’è‰²ï¼Œæ”¹å˜å’Œä¿®æ­£çˆ¶ç±»å¯¹æŠ½è±¡åŒ–çš„å®šä¹‰ã€‚</li>
  <li>å®ç°åŒ–(Implementor)è§’è‰²ï¼šå®šä¹‰å®ç°ç±»çš„æ¥å£ï¼Œä¸ç»™å‡ºå…·ä½“çš„å®ç°ã€‚æ­¤æ¥å£ä¸ä¸€å®šå’ŒæŠ½è±¡åŒ–è§’è‰²çš„æ¥å£å®šä¹‰ç›¸åŒï¼Œå®é™…ä¸Šï¼Œè¿™ä¸¤ä¸ªæ¥å£å¯ä»¥å®Œå…¨ä¸åŒã€‚å®ç°åŒ–è§’è‰²åº”å½“åªç»™å‡ºåº•å±‚æ“ä½œï¼Œè€ŒæŠ½è±¡åŒ–è§’è‰²åº”å½“åªç»™å‡ºåŸºäºåº•å±‚æ“ä½œçš„æ›´é«˜ä¸€å±‚çš„æ“ä½œã€‚</li>
  <li>å…·ä½“å®ç°åŒ–(Concrete Implementor)è§’è‰²ï¼šå®ç°å®ç°åŒ–è§’è‰²æ¥å£å¹¶å®šä¹‰å®ƒçš„å…·ä½“å®ç°ã€‚</li>
</ul>

<h3 id="é€‚ç”¨æ€§-3">é€‚ç”¨æ€§</h3>
<ul>
  <li>å¦‚æœä¸€ä¸ªç³»ç»Ÿéœ€è¦åœ¨æ„ä»¶çš„æŠ½è±¡åŒ–å’Œå…·ä½“åŒ–è§’è‰²ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§ï¼Œé¿å…åœ¨ä¸¤ä¸ªå±‚æ¬¡ä¹‹é—´å»ºç«‹é™æ€çš„è”ç³»ã€‚</li>
  <li>è®¾è®¡è¦æ±‚å®ç°åŒ–è§’è‰²çš„ä»»ä½•æ”¹å˜ä¸åº”å½“å½±å“å®¢æˆ·ç«¯ï¼Œæˆ–è€…è¯´å®ç°åŒ–è§’è‰²çš„æ”¹å˜å¯¹å®¢æˆ·ç«¯æ˜¯å®Œå…¨é€æ˜çš„ã€‚</li>
  <li>ä¸€ä¸ªæ„ä»¶æœ‰å¤šäºä¸€ä¸ªçš„æŠ½è±¡åŒ–è§’è‰²å’Œå®ç°åŒ–è§’è‰²ï¼Œå¹¶ä¸”ç³»ç»Ÿéœ€è¦å®ƒä»¬ä¹‹é—´è¿›è¡ŒåŠ¨æ€çš„è€¦åˆã€‚</li>
  <li>è™½ç„¶åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨ç»§æ‰¿æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯ç”±äºæŠ½è±¡åŒ–è§’è‰²å’Œå…·ä½“åŒ–è§’è‰²éœ€è¦ç‹¬ç«‹å˜åŒ–ï¼Œè®¾è®¡è¦æ±‚éœ€è¦ç‹¬ç«‹ç®¡ç†è¿™ä¸¤è€…ã€‚</li>
</ul>

<h3 id="ç±»å›¾-3">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-bridge-pattern-uml.jpg" alt="bridge pattern" /></p>

<h3 id="å®ä¾‹-3">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Abstraction</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡åŒ–è§’è‰²ï¼ŒæŠ½è±¡åŒ–ç»™å‡ºçš„å®šä¹‰ï¼Œå¹¶ä¿å­˜ä¸€ä¸ªå¯¹å®ç°åŒ–å¯¹è±¡çš„å¼•ç”¨ã€‚</span>
    <span class="k">protected</span> <span class="nv">$imp</span><span class="p">;</span> <span class="c1">// å¯¹å®ç°åŒ–å¯¹è±¡çš„å¼•ç”¨</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">imp</span><span class="o">-&gt;</span><span class="na">operationImp</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">RefinedAbstraction</span> <span class="k">extends</span> <span class="nx">Abstraction</span> <span class="p">{</span> <span class="c1">// ä¿®æ­£æŠ½è±¡åŒ–è§’è‰², æ‰©å±•æŠ½è±¡åŒ–è§’è‰²ï¼Œæ”¹å˜å’Œä¿®æ­£çˆ¶ç±»å¯¹æŠ½è±¡åŒ–çš„å®šä¹‰ã€‚</span>
     <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Implementor</span> <span class="nv">$imp</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">imp</span> <span class="o">=</span> <span class="nv">$imp</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">imp</span><span class="o">-&gt;</span><span class="na">operationImp</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Implementor</span> <span class="p">{</span> <span class="c1">// å®ç°åŒ–è§’è‰², ç»™å‡ºå®ç°åŒ–è§’è‰²çš„æ¥å£ï¼Œä½†ä¸ç»™å‡ºå…·ä½“çš„å®ç°ã€‚</span>
    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">operationImp</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteImplementorA</span> <span class="k">extends</span> <span class="nx">Implementor</span> <span class="p">{</span> <span class="c1">// å…·ä½“åŒ–è§’è‰²A</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operationImp</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteImplementorB</span> <span class="k">extends</span> <span class="nx">Implementor</span> <span class="p">{</span> <span class="c1">// å…·ä½“åŒ–è§’è‰²B</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operationImp</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$abstraction</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RefinedAbstraction</span><span class="p">(</span><span class="k">new</span> <span class="nx">ConcreteImplementorA</span><span class="p">());</span>
<span class="nv">$abstraction</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>

<span class="nv">$abstraction</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RefinedAbstraction</span><span class="p">(</span><span class="k">new</span> <span class="nx">ConcreteImplementorB</span><span class="p">());</span>
<span class="nv">$abstraction</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç‚¹-2">ä¼˜ç‚¹</h3>
<ul>
  <li>åˆ†ç¦»æ¥å£åŠå…¶å®ç°éƒ¨åˆ†, å°†Abstractionä¸Implementoråˆ†äº«æœ‰åŠ©äºé™ä½å¯¹å®ç°éƒ¨åˆ†ç¼–è¯‘æ—¶åˆ»çš„ä¾èµ–æ€§, æ¥å£ä¸å®ç°åˆ†äº«æœ‰åŠ©äºåˆ†å±‚ï¼Œä»è€Œäº§ç”Ÿæ›´å¥½çš„ç»“æ„åŒ–ç³»ç»Ÿ</li>
  <li>æé«˜å¯æ‰©å……æ€§</li>
  <li>å®ç°ç»†èŠ‚å¯¹å®¢æˆ·é€æ˜ã€‚</li>
</ul>

<h3 id="å‚è€ƒ-4">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Bridge_pattern">Wikipedia: Bridge pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E6%A9%8B%E6%8E%A5%E6%A8%A1%E5%BC%8F">Wikipedia: æ¡¥æ¥æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/06/php-design-pattern-5-bridge/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°æ¡¥æ¥æ¨¡å¼</a></li>
</ol>

<h2 id="åˆæˆæ¨¡å¼composite-pattern">åˆæˆæ¨¡å¼ï¼ˆComposite patternï¼‰</h2>
<p>åˆæˆæ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹æ¨¡å¼ï¼Œå®ƒå°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€éƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ã€‚Compositeä½¿ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚
Compositeå˜åŒ–çš„æ˜¯ä¸€ä¸ªå¯¹è±¡çš„ç»“æ„å’Œç»„æˆã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-1">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡ç»„ä»¶(Component)è§’è‰²ï¼šæŠ½è±¡è§’è‰²ï¼Œç»™å‚åŠ ç»„åˆçš„å¯¹è±¡è§„å®šä¸€ä¸ªæ¥å£ã€‚åœ¨é€‚å½“çš„æƒ…å†µä¸‹ï¼Œå®ç°æ‰€æœ‰ç±»å…±æœ‰æ¥å£çš„ç¼ºçœè¡Œä¸ºã€‚å£°æ˜ä¸€ä¸ªæ¥å£ç”¨äºè®¿é—®å’Œç®¡ç†Componentçš„å­ç»„ä»¶</li>
  <li>æ ‘å¶ç»„ä»¶(Leaf)è§’è‰²ï¼šåœ¨ç»„åˆä¸­è¡¨ç¤ºå¶èŠ‚ç‚¹å¯¹è±¡ï¼Œå¶èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ã€‚åœ¨ç»„åˆä¸­å®šä¹‰å›¾å…ƒå¯¹è±¡çš„è¡Œä¸ºã€‚</li>
  <li>æ ‘æç»„ä»¶(Composite)è§’è‰²ï¼šå­˜å‚¨å­éƒ¨ä»¶ã€‚å®šä¹‰æœ‰å­éƒ¨ä»¶çš„é‚£äº›éƒ¨ä»¶çš„è¡Œä¸ºã€‚åœ¨Componentæ¥å£ä¸­å®ç°ä¸å­éƒ¨ä»¶æœ‰å…³çš„æ“ä½œã€‚</li>
  <li>å®¢æˆ·ç«¯(Client)ï¼šé€šè¿‡Componentæ¥å£æ“çºµç»„åˆéƒ¨ä»¶çš„å¯¹è±¡</li>
</ul>

<h3 id="é€‚ç”¨æ€§-4">é€‚ç”¨æ€§</h3>

<ul>
  <li>ä½ æƒ³è¡¨ç¤ºå¯¹è±¡çš„éƒ¨åˆ†-æ•´ä½“å±‚æ¬¡ç»“æ„ã€‚</li>
  <li>ä½ å¸Œæœ›ç”¨æˆ·å¿½ç•¥ç»„åˆå¯¹è±¡å’Œå•ä¸ªå¯¹è±¡çš„ä¸åŒï¼Œç”¨æˆ·å°†ç»Ÿä¸€åœ°ä½¿ç”¨ç»„åˆç»“æ„ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚</li>
</ul>

<h3 id="ç±»å›¾-4">ç±»å›¾</h3>

<h4 id="å®‰å…¨å¼åˆæˆæ¨¡å¼">å®‰å…¨å¼åˆæˆæ¨¡å¼</h4>

<p><img src="http://imgs.yansu.org/tech-safe-composite-pattern-uml.jpg" alt="safe composite pattern" /></p>

<h4 id="é€æ˜å¼åˆæˆæ¨¡å¼">é€æ˜å¼åˆæˆæ¨¡å¼</h4>

<p><img src="http://imgs.yansu.org/tech-transparent-composite-pattern-uml.jpg" alt="transparent composite pattern" /></p>

<h3 id="å®ä¾‹-4">å®ä¾‹</h3>

<h4 id="å®‰å…¨å¼åˆæˆæ¨¡å¼-1">å®‰å…¨å¼åˆæˆæ¨¡å¼</h4>

<p>åœ¨Compositeç±»é‡Œé¢å£°æ˜æ‰€æœ‰çš„ç”¨æ¥ç®¡ç†å­ç±»å¯¹è±¡çš„æ–¹æ³•ã€‚è¿™æ ·çš„åšæ³•æ˜¯å®‰å…¨çš„ã€‚å› ä¸ºæ ‘å¶ç±»å‹çš„å¯¹è±¡æ ¹æœ¬å°±æ²¡æœ‰ç®¡ç†å­ç±»çš„æ–¹æ³•ï¼Œå› æ­¤ï¼Œå¦‚æœå®¢æˆ·ç«¯å¯¹æ ‘å¶ç±»å¯¹è±¡ä½¿ç”¨è¿™äº›æ–¹æ³•æ—¶ï¼Œç¨‹åºä¼šåœ¨ç¼–è¯‘æ—¶æœŸå‡ºé”™ã€‚ç¼–è¯‘é€šä¸è¿‡ï¼Œå°±ä¸ä¼šå‡ºç°è¿è¡Œæ—¶æœŸé”™è¯¯ã€‚è¿™æ ·çš„ç¼ºç‚¹æ˜¯ä¸å¤Ÿé€æ˜ï¼Œå› ä¸ºæ ‘å¶ç±»å’Œåˆæˆç±»å°†å…·æœ‰ä¸åŒçš„æ¥å£ã€‚</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">interface</span> <span class="nc">Component</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getComposite</span><span class="p">();</span> <span class="c1">//è¿”å›è‡ªå·±çš„å®ä¾‹</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Composite</span> <span class="k">implements</span> <span class="nx">Component</span> <span class="p">{</span> <span class="c1">// æ ‘æç»„ä»¶è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_composites</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getComposite</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span> <span class="p">}</span>
     <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">()</span> <span class="p">{</span>
         <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span> <span class="k">as</span> <span class="nv">$composite</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>
        <span class="p">}</span>
     <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">//èšé›†ç®¡ç†æ–¹æ³• æ·»åŠ ä¸€ä¸ªå­å¯¹è±¡</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$component</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">remove</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// èšé›†ç®¡ç†æ–¹æ³• åˆ é™¤ä¸€ä¸ªå­å¯¹è±¡</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$component</span> <span class="o">==</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span> <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span> <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getChild</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// èšé›†ç®¡ç†æ–¹æ³• è¿”å›æ‰€æœ‰çš„å­å¯¹è±¡</span>
       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Leaf</span> <span class="k">implements</span> <span class="nx">Component</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$_name</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getComposite</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="kc">null</span><span class="p">;}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$leaf1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Leaf</span><span class="p">(</span><span class="s1">'first'</span><span class="p">);</span>
<span class="nv">$leaf2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Leaf</span><span class="p">(</span><span class="s1">'second'</span><span class="p">);</span>

<span class="nv">$composite</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Composite</span><span class="p">();</span>
<span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$leaf1</span><span class="p">);</span>
<span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$leaf2</span><span class="p">);</span>
<span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>

<span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="nv">$leaf2</span><span class="p">);</span>
<span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h4 id="é€æ˜å¼åˆæˆæ¨¡å¼-1">é€æ˜å¼åˆæˆæ¨¡å¼</h4>
<p>åœ¨Compositeç±»é‡Œé¢å£°æ˜æ‰€æœ‰çš„ç”¨æ¥ç®¡ç†å­ç±»å¯¹è±¡çš„æ–¹æ³•ã€‚è¿™æ ·åšçš„æ˜¯å¥½å¤„æ˜¯æ‰€æœ‰çš„ç»„ä»¶ç±»éƒ½æœ‰ç›¸åŒçš„æ¥å£ã€‚åœ¨å®¢æˆ·ç«¯çœ‹æ¥ï¼Œæ ‘å¶ç±»å’Œåˆæˆç±»å¯¹è±¡çš„åŒºåˆ«èµ·ç åœ¨æ¥å£å±‚æ¬¡ä¸Šæ¶ˆå¤±äº†ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŒç­‰çš„å¯¹å¾…æ‰€æœ‰çš„å¯¹è±¡ã€‚è¿™å°±æ˜¯é€æ˜å½¢å¼çš„åˆæˆæ¨¡å¼ï¼Œç¼ºç‚¹å°±æ˜¯ä¸å¤Ÿå®‰å…¨ï¼Œå› ä¸ºæ ‘å¶ç±»å¯¹è±¡å’Œåˆæˆç±»å¯¹è±¡åœ¨æœ¬è´¨ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ã€‚æ ‘å¶ç±»å¯¹è±¡ä¸å¯èƒ½æœ‰ä¸‹ä¸€ä¸ªå±‚æ¬¡çš„å¯¹è±¡ï¼Œå› æ­¤è°ƒç”¨å…¶æ·»åŠ æˆ–åˆ é™¤æ–¹æ³•å°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œè¿™åœ¨ç¼–è¯‘æœŸé—´æ˜¯ä¸ä¼šå‡ºé”™çš„ï¼Œè€Œåªä¼šåœ¨è¿è¡Œæ—¶æœŸæ‰ä¼šå‡ºé”™ã€‚</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">interface</span> <span class="nc">Component</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡ç»„ä»¶è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getComposite</span><span class="p">();</span> <span class="c1">// è¿”å›è‡ªå·±çš„å®ä¾‹</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">();</span> <span class="c1">// ç¤ºä¾‹æ–¹æ³•</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">);</span> <span class="c1">// èšé›†ç®¡ç†æ–¹æ³•,æ·»åŠ ä¸€ä¸ªå­å¯¹è±¡</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">remove</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">);</span> <span class="c1">// èšé›†ç®¡ç†æ–¹æ³• åˆ é™¤ä¸€ä¸ªå­å¯¹è±¡</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getChild</span><span class="p">();</span> <span class="c1">// èšé›†ç®¡ç†æ–¹æ³• è¿”å›æ‰€æœ‰çš„å­å¯¹è±¡</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Composite</span> <span class="k">implements</span> <span class="nx">Component</span> <span class="p">{</span> <span class="c1">// æ ‘æç»„ä»¶è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_composites</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getComposite</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// ç¤ºä¾‹æ–¹æ³•ï¼Œè°ƒç”¨å„ä¸ªå­å¯¹è±¡çš„operationæ–¹æ³•</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span> <span class="k">as</span> <span class="nv">$composite</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// èšé›†ç®¡ç†æ–¹æ³• æ·»åŠ ä¸€ä¸ªå­å¯¹è±¡</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$component</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">remove</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// èšé›†ç®¡ç†æ–¹æ³• åˆ é™¤ä¸€ä¸ªå­å¯¹è±¡</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$component</span> <span class="o">==</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span> <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span> <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getChild</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// èšé›†ç®¡ç†æ–¹æ³• è¿”å›æ‰€æœ‰çš„å­å¯¹è±¡</span>
       <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_composites</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Leaf</span> <span class="k">implements</span> <span class="nx">Component</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$_name</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getComposite</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">remove</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getChild</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$leaf1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Leaf</span><span class="p">(</span><span class="s1">'first'</span><span class="p">);</span>
<span class="nv">$leaf2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Leaf</span><span class="p">(</span><span class="s1">'second'</span><span class="p">);</span>

<span class="nv">$composite</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Composite</span><span class="p">();</span>
<span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$leaf1</span><span class="p">);</span>
<span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$leaf2</span><span class="p">);</span>
<span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>

<span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="nv">$leaf2</span><span class="p">);</span>
<span class="nv">$composite</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-2">ä¼˜ç¼ºç‚¹</h3>
<h4 id="ä¼˜ç‚¹-3">ä¼˜ç‚¹</h4>

<ul>
  <li>ç®€åŒ–å®¢æˆ·ä»£ç </li>
  <li>ä½¿å¾—æ›´å®¹æ˜“å¢åŠ æ–°ç±»å‹çš„ç»„ä»¶</li>
</ul>

<h4 id="ç¼ºç‚¹-2">ç¼ºç‚¹</h4>

<ul>
  <li>ä½¿ä½ çš„è®¾è®¡å˜å¾—æ›´åŠ ä¸€èˆ¬åŒ–ï¼Œå®¹æ˜“å¢åŠ ç»„ä»¶ä¹Ÿä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ï¼Œé‚£å°±æ˜¯å¾ˆéš¾é™åˆ¶ç»„åˆä¸­çš„ç»„ä»¶</li>
</ul>

<h3 id="å‚è€ƒ-5">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Composite_pattern">Wikipedia: Composite pattern</a></li>
  <li><a href="http://www.phppan.com/2010/08/php-design-pattern-14-composite/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°åˆæˆæ¨¡å¼</a></li>
</ol>

<h2 id="è£…é¥°å™¨æ¨¡å¼decorator-pattern">è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator patternï¼‰</h2>
<p>è£…é¥°å™¨æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹æ¨¡å¼ï¼Œå®ƒåŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚å°±å¢åŠ åŠŸèƒ½æ¥è¯´ï¼ŒDecoratoræ¨¡å¼ç›¸æ¯”ç”Ÿæˆå­ç±»æ›´ä¸ºçµæ´»ã€GOF95ã€‘
è£…é¥°æ¨¡å¼æ˜¯ä»¥å¯¹å®¢æˆ·é€æ˜çš„æ–¹å¼åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡é™„åŠ ä¸Šæ›´å¤šçš„èŒè´£ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å¹¶ä¸ä¼šè§‰å¾—å¯¹è±¡åœ¨è£…é¥°å‰å’Œè£…é¥°åæœ‰ä»€ä¹ˆä¸åŒã€‚è£…é¥°æ¨¡å¼å¯ä»¥åœ¨ä¸ä½¿ç”¨åˆ›é€ æ›´å¤šå­ç±»çš„æƒ…å†µä¸‹ï¼Œå°†å¯¹è±¡çš„åŠŸèƒ½åŠ ä»¥æ‰©å±•ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-2">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡æ„ä»¶(Component)è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¥å£ï¼Œä»¥è§„èŒƒå‡†å¤‡æ¥æ”¶é™„åŠ èŒè´£çš„å¯¹è±¡ï¼Œä»è€Œå¯ä»¥ç»™è¿™äº›å¯¹è±¡åŠ¨æ€åœ°æ·»åŠ èŒè´£ã€‚</li>
  <li>å…·ä½“æ„ä»¶(Concrete Component)è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªå°†è¦æ¥æ”¶é™„åŠ èŒè´£çš„ç±»ã€‚</li>
  <li>è£…é¥°(Decorator)è§’è‰²ï¼šæŒæœ‰ä¸€ä¸ªæŒ‡å‘Componentå¯¹è±¡çš„æŒ‡é’ˆï¼Œå¹¶å®šä¹‰ä¸€ä¸ªä¸Componentæ¥å£ä¸€è‡´çš„æ¥å£ã€‚</li>
  <li>å…·ä½“è£…é¥°(Concrete Decorator)è§’è‰²ï¼šè´Ÿè´£ç»™æ„ä»¶å¯¹è±¡å¢åŠ é™„åŠ çš„èŒè´£ã€‚</li>
</ul>

<h3 id="é€‚ç”¨æ€§-5">é€‚ç”¨æ€§</h3>

<ul>
  <li>åœ¨ä¸å½±å“å…¶ä»–å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œä»¥åŠ¨æ€ã€é€æ˜çš„æ–¹å¼ç»™å•ä¸ªå¯¹è±¡æ·»åŠ èŒè´£ã€‚</li>
  <li>å¤„ç†é‚£äº›å¯ä»¥æ’¤æ¶ˆçš„èŒè´£ï¼Œå³éœ€è¦åŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ åŠŸèƒ½å¹¶ä¸”è¿™äº›åŠŸèƒ½æ˜¯å¯ä»¥åŠ¨æ€çš„æ’¤æ¶ˆçš„ã€‚</li>
  <li>å½“ä¸èƒ½å½©ç”Ÿæˆå­ç±»çš„æ–¹æ³•è¿›è¡Œæ‰©å……æ—¶ã€‚ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¯èƒ½æœ‰å¤§é‡ç‹¬ç«‹çš„æ‰©å±•ï¼Œä¸ºæ”¯æŒæ¯ä¸€ç§ç»„åˆå°†äº§ç”Ÿå¤§é‡çš„å­ç±»ï¼Œä½¿å¾—å­ç±»æ•°ç›®å‘ˆçˆ†ç‚¸æ€§å¢é•¿ã€‚å¦ä¸€ç§æƒ…å†µå¯èƒ½æ˜¯å› ä¸ºç±»å®šä¹‰è¢«éšè—ï¼Œæˆ–ç±»å®šä¹‰ä¸èƒ½ç”¨äºç”Ÿæˆå­ç±»ã€‚</li>
</ul>

<h3 id="ç±»å›¾-5">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-decorator-pattern-uml.jpg" alt="decorator pattern" /></p>

<h3 id="å®ä¾‹-5">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">interface</span> <span class="nc">Component</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Decorator</span> <span class="k">implements</span> <span class="nx">Component</span><span class="p">{</span> <span class="c1">// è£…é¥°è§’è‰²</span>
    <span class="k">protected</span>  <span class="nv">$_component</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_component</span> <span class="o">=</span> <span class="nv">$component</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_component</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteDecoratorA</span> <span class="k">extends</span> <span class="nx">Decorator</span> <span class="p">{</span> <span class="c1">// å…·ä½“è£…é¥°ç±»A</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$component</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">operation</span><span class="p">();</span>    <span class="c1">//  è°ƒç”¨è£…é¥°ç±»çš„æ“ä½œ</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addedOperationA</span><span class="p">();</span>   <span class="c1">//  æ–°å¢åŠ çš„æ“ä½œ</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addedOperationA</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteDecoratorB</span> <span class="k">extends</span> <span class="nx">Decorator</span> <span class="p">{</span> <span class="c1">// å…·ä½“è£…é¥°ç±»B</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Component</span> <span class="nv">$component</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$component</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">operation</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addedOperationB</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">addedOperationB</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteComponent</span> <span class="k">implements</span> <span class="nx">Component</span><span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// clients</span>
<span class="nv">$component</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteComponent</span><span class="p">();</span>
<span class="nv">$decoratorA</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteDecoratorA</span><span class="p">(</span><span class="nv">$component</span><span class="p">);</span>
<span class="nv">$decoratorB</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteDecoratorB</span><span class="p">(</span><span class="nv">$decoratorA</span><span class="p">);</span>

<span class="nv">$decoratorA</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>
<span class="nv">$decoratorB</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-3">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-4">ä¼˜ç‚¹</h4>
<ul>
  <li>æ¯”é™æ€ç»§æ‰¿æ›´çµæ´»ï¼›</li>
  <li>é¿å…åœ¨å±‚æ¬¡ç»“æ„é«˜å±‚çš„ç±»æœ‰å¤ªå¤šçš„ç‰¹å¾</li>
</ul>

<h4 id="ç¼ºç‚¹-3">ç¼ºç‚¹</h4>
<ul>
  <li>ä½¿ç”¨è£…é¥°æ¨¡å¼ä¼šäº§ç”Ÿæ¯”ä½¿ç”¨ç»§æ‰¿å…³ç³»æ›´å¤šçš„å¯¹è±¡ã€‚å¹¶ä¸”è¿™äº›å¯¹è±¡çœ‹ä¸Šå»éƒ½å¾ˆæƒ³åƒï¼Œä»è€Œä½¿å¾—æŸ¥é”™å˜å¾—å›°éš¾ã€‚</li>
</ul>

<h3 id="å‚è€ƒ-6">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Decorator_pattern">Wikipedia: Decorator pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E4%BF%AE%E9%A5%B0%E6%A8%A1%E5%BC%8F">Wikipedia: ä¿®é¥°æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/06/php-design-pattern-4-decorator/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°è£…é¥°æ¨¡å¼</a></li>
</ol>

<h2 id="é—¨é¢æ¨¡å¼facade-pattern">é—¨é¢æ¨¡å¼ï¼ˆFacade patternï¼‰</h2>
<p>é—¨é¢æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹æ¨¡å¼ï¼Œå®ƒä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼ŒFacadeæ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¬¡çš„æ¥å£ï¼Œä½¿å¾—å­ç³»ç»Ÿæ›´åŠ å®¹æ˜“ä½¿ç”¨ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-3">ä¸»è¦è§’è‰²</h3>

<h4 id="é—¨é¢facadeè§’è‰²">é—¨é¢(Facade)è§’è‰²</h4>

<ul>
  <li>æ­¤è§’è‰²å°†è¢«å®¢æˆ·ç«¯è°ƒç”¨</li>
  <li>çŸ¥é“å“ªäº›å­ç³»ç»Ÿè´Ÿè´£å¤„ç†è¯·æ±‚</li>
  <li>å°†ç”¨æˆ·çš„è¯·æ±‚æŒ‡æ´¾ç»™é€‚å½“çš„å­ç³»ç»Ÿ</li>
</ul>

<h4 id="å­ç³»ç»Ÿsubsystemè§’è‰²">å­ç³»ç»Ÿ(subsystem)è§’è‰²</h4>

<ul>
  <li>å®ç°å­ç³»ç»Ÿçš„åŠŸèƒ½</li>
  <li>å¤„ç†ç”±Facadeå¯¹è±¡æŒ‡æ´¾çš„ä»»åŠ¡</li>
  <li>æ²¡æœ‰Facadeçš„ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥è¢«å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨</li>
  <li>å¯ä»¥åŒæ—¶æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­ç³»ç»Ÿï¼Œæ¯ä¸ªå­ç³»ç»Ÿéƒ½ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œè€Œä¸€ä¸ªç±»çš„é›†åˆã€‚æ¯ä¸ªå­ç³»ç»Ÿéƒ½å¯ä»¥è¢«å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨ï¼Œæˆ–è€…è¢«é—¨é¢è§’è‰²è°ƒç”¨ã€‚å­ç³»ç»Ÿå¹¶çŸ¥é“é—¨é¢æ¨¡å¼çš„å­˜åœ¨ï¼Œå¯¹äºå­ç³»ç»Ÿè€Œè¨€ï¼Œé—¨é¢ä»…ä»…æ˜¯å¦ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚</li>
</ul>

<h3 id="é€‚ç”¨æ€§-6">é€‚ç”¨æ€§</h3>

<ul>
  <li>ä¸ºä¸€äº›å¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ç»„æ¥å£</li>
  <li>æé«˜å­ç³»ç»Ÿçš„ç‹¬ç«‹æ€§</li>
  <li>åœ¨å±‚æ¬¡åŒ–ç»“æ„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é—¨é¢æ¨¡å¼å®šä¹‰ç³»ç»Ÿçš„æ¯ä¸€å±‚çš„æ¥å£</li>
</ul>

<h3 id="ç±»å›¾-6">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-facade-pattern-uml.jpg" alt="facade pattern" /></p>

<h3 id="å®ä¾‹-6">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">Camera</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">turnOn</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">turnOff</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">rotate</span><span class="p">(</span><span class="nv">$degrees</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Light</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">turnOn</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">turnOff</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">changeBulb</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Sensor</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">activate</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">deactivate</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">trigger</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Alarm</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">activate</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">deactivate</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">ring</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">stopRing</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">SecurityFacade</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$_camera1</span><span class="p">,</span> <span class="nv">$_camera2</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$_light1</span><span class="p">,</span> <span class="nv">$_light2</span><span class="p">,</span> <span class="nv">$_light3</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$_sensor</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$_alarm</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_camera1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Camera</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_camera2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Camera</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_light1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Light</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_light2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Light</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_light3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Light</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_sensor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sensor</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_alarm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Alarm</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">activate</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_camera1</span><span class="o">-&gt;</span><span class="na">turnOn</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_camera2</span><span class="o">-&gt;</span><span class="na">turnOn</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_light1</span><span class="o">-&gt;</span><span class="na">turnOn</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_light2</span><span class="o">-&gt;</span><span class="na">turnOn</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_light3</span><span class="o">-&gt;</span><span class="na">turnOn</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_sensor</span><span class="o">-&gt;</span><span class="na">activate</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_alarm</span><span class="o">-&gt;</span><span class="na">activate</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span>  <span class="k">function</span> <span class="nf">deactivate</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_camera1</span><span class="o">-&gt;</span><span class="na">turnOff</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_camera2</span><span class="o">-&gt;</span><span class="na">turnOff</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_light1</span><span class="o">-&gt;</span><span class="na">turnOff</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_light2</span><span class="o">-&gt;</span><span class="na">turnOff</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_light3</span><span class="o">-&gt;</span><span class="na">turnOff</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_sensor</span><span class="o">-&gt;</span><span class="na">deactivate</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_alarm</span><span class="o">-&gt;</span><span class="na">deactivate</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1">//client</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SecurityFacade</span><span class="p">();</span>
<span class="nv">$security</span><span class="o">-&gt;</span><span class="na">activate</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-4">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-5">ä¼˜ç‚¹</h4>

<ul>
  <li>å®ƒå¯¹å®¢æˆ·å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ï¼Œå› è€Œå‡å°‘äº†å®¢æˆ·å¤„ç†çš„å¯¹è±¡çš„æ•°ç›®å¹¶ä½¿å¾—å­ç³»ç»Ÿä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿</li>
  <li>å®ç°äº†å­ç³»ç»Ÿä¸å®¢æˆ·ä¹‹é—´çš„æ¾è€¦åˆå…³ç³»</li>
  <li>å¦‚æœåº”ç”¨éœ€è¦ï¼Œå®ƒå¹¶ä¸é™åˆ¶å®ƒä»¬ä½¿ç”¨å­ç³»ç»Ÿç±»ã€‚å› æ­¤å¯ä»¥åœ¨ç³»ç»Ÿæ˜“ç”¨æ€§ä¸èƒ½ç”¨æ€§ä¹‹é—´åŠ ä»¥é€‰æ‹©</li>
</ul>

<h3 id="å‚è€ƒ-7">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Facade_pattern">Wikipedia: Facade pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E5%A4%96%E8%A7%80%E6%A8%A1%E5%BC%8F">Wikipedia: å¤–è§‚æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/06/php-design-pattern-7-facade/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°é—¨é¢æ¨¡å¼</a></li>
</ol>

<h2 id="äº«å…ƒæ¨¡å¼flyweight-pattern">äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰</h2>
<p>äº«å…ƒæ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹æ¨¡å¼ï¼Œå®ƒä½¿ç”¨å…±äº«ç‰©ä»¶ï¼Œç”¨æ¥å°½å¯èƒ½å‡å°‘å†…å­˜ä½¿ç”¨é‡ä»¥åŠåˆ†äº«èµ„è®¯ç»™å°½å¯èƒ½å¤šçš„ç›¸ä¼¼ç‰©ä»¶ï¼›å®ƒé€‚åˆç”¨äºå½“å¤§é‡ç‰©ä»¶åªæ˜¯é‡å¤å› è€Œå¯¼è‡´æ— æ³•ä»¤äººæ¥å—çš„ä½¿ç”¨å¤§é‡å†…å­˜ã€‚é€šå¸¸ç‰©ä»¶ä¸­çš„éƒ¨åˆ†çŠ¶æ€æ˜¯å¯ä»¥åˆ†äº«ã€‚å¸¸è§åšæ³•æ˜¯æŠŠå®ƒä»¬æ”¾åœ¨å¤–éƒ¨æ•°æ®ç»“æ„ï¼Œå½“éœ€è¦ä½¿ç”¨æ—¶å†å°†å®ƒä»¬ä¼ é€’ç»™äº«å…ƒã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-4">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡äº«å…ƒ(Flyweightè§’è‰²ï¼šæ­¤è§’è‰²æ˜¯æ‰€æœ‰çš„å…·ä½“äº«å…ƒç±»çš„è¶…ç±»ï¼Œä¸ºè¿™äº›ç±»è§„å®šå‡ºéœ€è¦å®ç°çš„å…¬å…±æ¥å£ã€‚é‚£äº›éœ€è¦å¤–è•´çŠ¶æ€çš„æ“ä½œå¯ä»¥é€šè¿‡è°ƒç”¨å•†ä¸šä»¥å‚æ•°å½¢å¼ä¼ å…¥</li>
  <li>å…·ä½“äº«å…ƒ(ConcreteFlyweightè§’è‰²ï¼šå®ç°Flyweightæ¥å£ï¼Œå¹¶ä¸ºå†…éƒ¨çŠ¶æ€ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æ‹‰å›å­˜å‚¨ç©ºé—´ã€‚ConcreteFlyweightå¯¹è±¡å¿…é¡»æ˜¯å¯å…±äº«çš„ã€‚å®ƒæ‰€å­˜å‚¨çš„çŠ¶æ€å¿…é¡»æ˜¯å†…éƒ¨çš„</li>
  <li>ä¸å…±äº«çš„å…·ä½“äº«å…ƒï¼ˆUnsharedConcreteFlyweightï¼‰è§’è‰²ï¼šå¹¶éæ‰€æœ‰çš„Flyweightå­ç±»éƒ½éœ€è¦è¢«å…±äº«ã€‚Flyweigthä½¿å…±äº«æˆä¸ºå¯èƒ½ï¼Œä½†å®ƒå¹¶ä¸å¼ºåˆ¶å…±äº«ã€‚</li>
  <li>äº«å…ƒå·¥å‚(FlyweightFactory)è§’è‰²ï¼šè´Ÿè´£åˆ›å»ºå’Œç®¡ç†äº«å…ƒè§’è‰²ã€‚æœ¬è§’è‰²å¿…é¡»ä¿è¯äº«å…ƒå¯¹è±¡å¯èƒ½è¢«ç³»ç»Ÿé€‚å½“åœ°å…±äº«</li>
  <li>å®¢æˆ·ç«¯(Client)è§’è‰²ï¼šæœ¬è§’è‰²éœ€è¦ç»´æŠ¤ä¸€ä¸ªå¯¹æ‰€æœ‰äº«å…ƒå¯¹è±¡çš„å¼•ç”¨ã€‚æœ¬è§’è‰²éœ€è¦è‡ªè¡Œå­˜å‚¨æ‰€æœ‰äº«å…ƒå¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€</li>
</ul>

<h3 id="é€‚ç”¨æ€§-7">é€‚ç”¨æ€§</h3>

<ul>
  <li>ä¸€ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨äº†å¤§é‡çš„å¯¹è±¡</li>
  <li>å®Œå…¨ç”±äºä½¿ç”¨å¤§é‡çš„å¯¹è±¡ï¼Œé€ æˆå¾ˆå¤§çš„å­˜å‚¨å¼€é”€</li>
  <li>å¯¹è±¡çš„å¤§å¤šæ•°çŠ¶æ€éƒ½å¯å˜ä¸ºå¤–éƒ¨çŠ¶æ€</li>
  <li>å¦‚æœåˆ é™¤å¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ç›¸å¯¹è¾ƒå°‘çš„å…±äº«å¯¹è±¡å–ä»£å¾ˆå¤šç»„å¯¹è±¡</li>
  <li>åº”ç”¨ç¨‹åºä¸ä¾èµ–äºå¯¹è±¡æ ‡è¯†ã€‚</li>
</ul>

<h3 id="ç±»å›¾-7">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-flyweight-pattern-uml.jpg" alt="flyweight pattern" /></p>

<h3 id="å®ä¾‹-7">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Flyweight</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡äº«å…ƒè§’è‰²</span>
    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">(</span><span class="nv">$state</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteFlyweight</span> <span class="k">extends</span> <span class="nx">Flyweight</span> <span class="p">{</span> <span class="c1">// å…·ä½“äº«å…ƒè§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_intrinsicState</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_intrinsicState</span> <span class="o">=</span> <span class="nv">$state</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">UnsharedConcreteFlyweight</span> <span class="k">extends</span> <span class="nx">Flyweight</span> <span class="p">{</span> <span class="c1">// ä¸å…±äº«çš„å…·ä½“äº«å…ƒï¼Œå®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨</span>
    <span class="k">private</span> <span class="nv">$_intrinsicState</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_intrinsicState</span> <span class="o">=</span> <span class="nv">$state</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operation</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">FlyweightFactory</span> <span class="p">{</span> <span class="c1">// äº«å…ƒå·¥å‚è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_flyweights</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_flyweights</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getFlyweigth</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_flyweights</span><span class="p">[</span><span class="nv">$state</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_flyweights</span><span class="p">[</span><span class="nv">$state</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_flyweights</span><span class="p">[</span><span class="nv">$state</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteFlyweight</span><span class="p">(</span><span class="nv">$state</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$flyweightFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FlyweightFactory</span><span class="p">();</span>
<span class="nv">$flyweight</span> <span class="o">=</span> <span class="nv">$flyweightFactory</span><span class="o">-&gt;</span><span class="na">getFlyweigth</span><span class="p">(</span><span class="s1">'state A'</span><span class="p">);</span>
<span class="nv">$flyweight</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">(</span><span class="s1">'other state A'</span><span class="p">);</span>

<span class="nv">$flyweight</span> <span class="o">=</span> <span class="nv">$flyweightFactory</span><span class="o">-&gt;</span><span class="na">getFlyweigth</span><span class="p">(</span><span class="s1">'state B'</span><span class="p">);</span>
<span class="nv">$flyweight</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">(</span><span class="s1">'other state B'</span><span class="p">);</span>

<span class="c1">// ä¸å…±äº«çš„å¯¹è±¡ï¼Œå•ç‹¬è°ƒç”¨</span>
<span class="nv">$uflyweight</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UnsharedConcreteFlyweight</span><span class="p">(</span><span class="s1">'state A'</span><span class="p">);</span>
<span class="nv">$uflyweight</span><span class="o">-&gt;</span><span class="na">operation</span><span class="p">(</span><span class="s1">'other state A'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-5">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-6">ä¼˜ç‚¹</h4>

<ul>
  <li>Flyweightæ¨¡å¼å¯ä»¥å¤§å¹…åº¦åœ°é™ä½å†…å­˜ä¸­å¯¹è±¡çš„æ•°é‡ã€‚</li>
</ul>

<h4 id="ç¼ºç‚¹-4">ç¼ºç‚¹</h4>

<ul>
  <li>Flyweightæ¨¡å¼ä½¿å¾—ç³»ç»Ÿæ›´åŠ å¤æ‚</li>
  <li>Flyweigthæ¨¡å¼å°†äº«å…ƒå¯¹è±¡çš„çŠ¶æ€å¤–éƒ¨åŒ–ï¼Œè€Œè¯»å–å¤–éƒ¨çŠ¶æ€ä½¿å¾—è¿è¡Œæ—¶é—´ç¨å¾®å˜é•¿</li>
</ul>

<h3 id="å‚è€ƒ-8">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Flyweight_pattern">Wikipedia: Flyweight pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F">Wikipedia: äº«å…ƒæ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/08/php-design-pattern-13-flyweight/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°äº«å…ƒæ¨¡å¼</a></li>
</ol>

<h2 id="è§‚å¯Ÿè€…æ¨¡å¼observer-pattern">è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver patternï¼‰</h2>
<p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚</p>

<p>åˆç§°ä¸ºå‘å¸ƒ-è®¢é˜…ï¼ˆPublish-Subscribeï¼‰æ¨¡å¼ã€æ¨¡å‹-è§†å›¾ï¼ˆModel-Viewï¼‰æ¨¡å¼ã€æº-ç›‘å¬ï¼ˆSource-Listenerï¼‰æ¨¡å¼ã€æˆ–ä»å±è€…(Dependents)æ¨¡å¼</p>

<h3 id="ä¸»è¦è§’è‰²-5">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰è§’è‰²ï¼šä¸»é¢˜è§’è‰²å°†æ‰€æœ‰å¯¹è§‚å¯Ÿè€…å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œæ¯ä¸ªä¸»é¢˜å¯ä»¥æœ‰ä»»æ„å¤šä¸ªè§‚å¯Ÿè€…ã€‚æŠ½è±¡ä¸»é¢˜æä¾›äº†å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡çš„æ¥å£ã€‚</li>
  <li>æŠ½è±¡è§‚å¯Ÿè€…ï¼ˆObserverï¼‰è§’è‰²ï¼šä¸ºæ‰€æœ‰çš„å…·ä½“è§‚å¯Ÿè€…å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œåœ¨è§‚å¯Ÿçš„ä¸»é¢˜å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–°è‡ªå·±ã€‚</li>
  <li>å…·ä½“ä¸»é¢˜ï¼ˆConcreteSubjectï¼‰è§’è‰²ï¼šå­˜å‚¨ç›¸å…³çŠ¶æ€åˆ°å…·ä½“è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå½“å…·ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œç»™æ‰€æœ‰ç™»è®°è¿‡çš„è§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ã€‚å…·ä½“ä¸»é¢˜è§’è‰²é€šå¸¸ç”¨ä¸€ä¸ªå…·ä½“å­ç±»å®ç°ã€‚</li>
  <li>å…·ä½“è§‚å¯Ÿè€…ï¼ˆConcretedObserverï¼‰è§’è‰²ï¼šå­˜å‚¨ä¸€ä¸ªå…·ä½“ä¸»é¢˜å¯¹è±¡ï¼Œå­˜å‚¨ç›¸å…³çŠ¶æ€ï¼Œå®ç°æŠ½è±¡è§‚å¯Ÿè€…è§’è‰²æ‰€è¦æ±‚çš„æ›´æ–°æ¥å£ï¼Œä»¥ä½¿å¾—å…¶è‡ªèº«çŠ¶æ€å’Œä¸»é¢˜çš„çŠ¶æ€ä¿æŒä¸€è‡´ã€‚</li>
</ul>

<h3 id="é€‚ç”¨æ€§-8">é€‚ç”¨æ€§</h3>

<ul>
  <li>å½“ä¸€ä¸ªæŠ½è±¡æ¨¡å‹æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹é¢ä¾èµ–äºå¦ä¸€ä¸ªæ–¹é¢ã€‚</li>
  <li>å½“å¯¹ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜éœ€è¦åŒæ—¶æ”¹å˜å…¶å®ƒå¯¹è±¡ï¼Œè€Œä¸çŸ¥é“å…·ä½“æœ‰å¤šå°‘ä¸ªå¯¹è±¡å¾…æ”¹å˜ã€‚</li>
  <li>å½“ä¸€ä¸ªå¯¹è±¡å¿…é¡»é€šçŸ¥å…¶å®ƒå¯¹è±¡ï¼Œè€Œå®ƒåˆä¸èƒ½å‡å®šå…¶å®ƒå¯¹è±¡æ˜¯è°ã€‚æ¢å¥è¯è¯´ï¼Œä½ ä¸å¸Œæœ›è¿™äº›å¯¹è±¡æ˜¯ç´§å¯†è€¦åˆçš„ã€‚</li>
</ul>

<h3 id="ç±»å›¾-8">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-observer-pattern-uml.jpg" alt="observer pattern" /></p>

<h3 id="å®ä¾‹-8">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">interface</span> <span class="nc">Subject</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡ä¸»é¢˜è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">attach</span><span class="p">(</span><span class="nx">Observer</span> <span class="nv">$observer</span><span class="p">);</span> <span class="c1">// å¢åŠ ä¸€ä¸ªæ–°çš„è§‚å¯Ÿè€…å¯¹è±¡</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">detach</span><span class="p">(</span><span class="nx">Observer</span> <span class="nv">$observer</span><span class="p">);</span> <span class="c1">// åˆ é™¤ä¸€ä¸ªå·²æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å¯¹è±¡</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">notifyObservers</span><span class="p">();</span> <span class="c1">// é€šçŸ¥æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å¯¹è±¡</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteSubject</span> <span class="k">implements</span> <span class="nx">Subject</span> <span class="p">{</span> <span class="c1">// å…·ä½“ä¸»é¢˜è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_observers</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_observers</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">attach</span><span class="p">(</span><span class="nx">Observer</span> <span class="nv">$observer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">array_push</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_observers</span><span class="p">,</span> <span class="nv">$observer</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">detach</span><span class="p">(</span><span class="nx">Observer</span> <span class="nv">$observer</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$index</span> <span class="o">=</span> <span class="nb">array_search</span><span class="p">(</span><span class="nv">$observer</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_observers</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$index</span> <span class="o">===</span> <span class="k">FALSE</span> <span class="o">||</span> <span class="o">!</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$index</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_observers</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_observers</span><span class="p">[</span><span class="nv">$index</span><span class="p">]);</span>
        <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">notifyObservers</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_observers</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_observers</span> <span class="k">as</span> <span class="nv">$observer</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$observer</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">interface</span> <span class="nc">Observer</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡è§‚å¯Ÿè€…è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">();</span> <span class="c1">// æ›´æ–°æ–¹æ³•</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteObserver</span> <span class="k">implements</span> <span class="nx">Observer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$_name</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="nv">$subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteSubject</span><span class="p">();</span>

<span class="cm">/* æ·»åŠ ç¬¬ä¸€ä¸ªè§‚å¯Ÿè€… */</span>
<span class="nv">$observer1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteObserver</span><span class="p">(</span><span class="s1">'Mac'</span><span class="p">);</span>
<span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer1</span><span class="p">);</span>
<span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">notifyObservers</span><span class="p">();</span> <span class="c1">// ä¸»é¢˜å˜åŒ–ï¼Œé€šçŸ¥è§‚å¯Ÿè€…</span>

<span class="cm">/* æ·»åŠ ç¬¬äºŒä¸ªè§‚å¯Ÿè€… */</span>
<span class="nv">$observer2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteObserver</span><span class="p">(</span><span class="s1">'Win'</span><span class="p">);</span>
<span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$observer2</span><span class="p">);</span>
<span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">notifyObservers</span><span class="p">();</span>

<span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">(</span><span class="nv">$observer1</span><span class="p">);</span>
<span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">notifyObservers</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-6">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-7">ä¼˜ç‚¹</h4>

<ul>
  <li>è§‚å¯Ÿè€…å’Œä¸»é¢˜ä¹‹é—´çš„è€¦åˆåº¦è¾ƒå°ã€‚</li>
  <li>æ”¯æŒå¹¿æ’­é€šä¿¡ã€‚</li>
</ul>

<h4 id="ç¼ºç‚¹-5">ç¼ºç‚¹</h4>

<ul>
  <li>ç”±äºè§‚å¯Ÿè€…å¹¶ä¸çŸ¥é“å…¶å®ƒè§‚å¯Ÿè€…çš„å­˜åœ¨ï¼Œå®ƒå¯èƒ½å¯¹æ”¹å˜ç›®æ ‡çš„æœ€ç»ˆä»£ä»·ä¸€æ— æ‰€çŸ¥ã€‚è¿™å¯èƒ½ä¼šå¼•èµ·æ„å¤–çš„æ›´æ–°ã€‚</li>
</ul>

<h3 id="å‚è€ƒ-9">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Observer_pattern">Wikipedia: Observer pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F">Wikipedia: è§‚å¯Ÿè€…æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/09/php-design-pattern-17-observer/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°è§‚å¯Ÿè€…æ¨¡å¼</a></li>
</ol>

<h2 id="åŸå‹æ¨¡å¼prototype-pattern">åŸå‹æ¨¡å¼ï¼ˆPrototype patternï¼‰</h2>
<p>åŸå‹æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºè€…æ¨¡å¼ï¼Œå…¶ç‰¹ç‚¹åœ¨äºé€šè¿‡â€œå¤åˆ¶â€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å®ä¾‹æ¥è¿”å›æ–°çš„å®ä¾‹,è€Œä¸æ˜¯æ–°å»ºå®ä¾‹ã€‚</p>

<h3 id="åŸå‹æ¨¡å¼ä¸­ä¸»è¦è§’è‰²">åŸå‹æ¨¡å¼ä¸­ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡åŸå‹(Prototype)è§’è‰²ï¼šå£°æ˜ä¸€ä¸ªå…‹éš†è‡ªå·±çš„æ¥å£</li>
  <li>å…·ä½“åŸå‹(Concrete Prototype)è§’è‰²ï¼šå®ç°ä¸€ä¸ªå…‹éš†è‡ªå·±çš„æ“ä½œ</li>
</ul>

<h3 id="é€‚ç”¨æ€§-9">é€‚ç”¨æ€§</h3>

<ul>
  <li>å½“ä¸€ä¸ªç³»ç»Ÿåº”è¯¥ç‹¬ç«‹äºå®ƒçš„äº§å“åˆ›å»ºã€æ„æˆå’Œè¡¨ç¤ºæ—¶ï¼Œè¦ä½¿ç”¨Prototypeæ¨¡å¼</li>
  <li>å½“è¦å®ä¾‹åŒ–çš„ç±»æ˜¯åœ¨è¿è¡Œæ—¶åˆ»æŒ‡å®šæ—¶ï¼Œä¾‹å¦‚åŠ¨æ€åŠ è½½</li>
  <li>ä¸ºäº†é¿å…åˆ›å»ºä¸€ä¸ªä¸äº§å“ç±»å±‚æ¬¡å¹³ç­‰çš„å·¥å‚ç±»å±‚æ¬¡æ—¶ï¼›</li>
  <li>å½“ä¸€ä¸ªç±»çš„å®ä¾‹åªèƒ½æœ‰å‡ ä¸ªä¸åŒçŠ¶æ€ç»„åˆä¸­çš„ä¸€ç§æ—¶ã€‚å»ºç«‹ç›¸åº”æ•°ç›®çš„åŸå‹å¹¶å…‹éš†å®ƒä»¬å¯èƒ½æ¯”æ¯æ¬¡ç”¨åˆé€‚çš„çŠ¶æ€æ‰‹å·¥å®ä¾‹åŒ–è¯¥ç±»æ›´æ–¹ä¾¿ä¸€äº›</li>
</ul>

<h3 id="ç±»å›¾-9">ç±»å›¾</h3>
<p><img src="http://imgs.yansu.org/tech-prototype-pattern-uml.jpg" alt="prototype pattern" /></p>

<h3 id="å®ä¾‹-9">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kd">interface</span> <span class="nc">Prototype</span> <span class="p">{</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">copy</span><span class="p">();</span> <span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcretePrototype</span> <span class="k">implements</span> <span class="nx">Prototype</span><span class="p">{</span>
    <span class="k">private</span>  <span class="nv">$_name</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">copy</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">clone</span> <span class="nv">$this</span><span class="p">;}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Demo</span> <span class="p">{}</span>

<span class="c1">// client</span>

<span class="nv">$demo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Demo</span><span class="p">();</span>
<span class="nv">$object1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcretePrototype</span><span class="p">(</span><span class="nv">$demo</span><span class="p">);</span>
<span class="nv">$object2</span> <span class="o">=</span> <span class="nv">$object1</span><span class="o">-&gt;</span><span class="na">copy</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-7">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-8">ä¼˜ç‚¹</h4>
<ul>
  <li>å¯ä»¥åœ¨è¿è¡Œæ—¶åˆ»å¢åŠ å’Œåˆ é™¤äº§å“</li>
  <li>å¯ä»¥æ”¹å˜å€¼ä»¥æŒ‡å®šæ–°å¯¹è±¡</li>
  <li>å¯ä»¥æ”¹å˜ç»“æ„ä»¥æŒ‡å®šæ–°å¯¹è±¡</li>
  <li>å‡å°‘å­ç±»çš„æ„é€ </li>
  <li>ç”¨ç±»åŠ¨æ€é…ç½®åº”ç”¨</li>
</ul>

<h4 id="ç¼ºç‚¹-6">ç¼ºç‚¹</h4>
<p>Prototypeæ¨¡å¼çš„æœ€ä¸»è¦ç¼ºç‚¹å°±æ˜¯æ¯ä¸€ä¸ªç±»å¿…é¡»é…å¤‡ä¸€ä¸ªå…‹éš†æ–¹æ³•ã€‚è€Œä¸”è¿™ä¸ªå…‹éš†æ–¹æ³•éœ€è¦å¯¹ç±»çš„åŠŸèƒ½è¿›è¡Œé€šç›˜è€ƒè™‘ï¼Œè¿™å¯¹å…¨æ–°çš„ç±»æ¥è¯´ä¸æ˜¯å¾ˆéš¾ï¼Œä½†å¯¹å·²æœ‰çš„ç±»è¿›è¡Œæ”¹é€ æ—¶ï¼Œä¸ä¸€å®šæ˜¯ä»¶å®¹æ˜“çš„äº‹ã€‚</p>

<h3 id="å‚è€ƒ-10">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Prototype_pattern">Wikipedia: Prototype pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F">Wikipedia: åŸå‹æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/06/php-design-pattern-8-prototype/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°åŸå‹æ¨¡å¼</a></li>
</ol>

<h2 id="ä»£ç†æ¨¡å¼proxy-pattern">ä»£ç†æ¨¡å¼ï¼ˆProxy patternï¼‰</h2>
<p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹æ¨¡å¼ï¼Œå®ƒå¯ä»¥ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-6">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡ä¸»é¢˜è§’è‰²(Subject)ï¼šå®ƒçš„ä½œç”¨æ˜¯ç»Ÿä¸€æ¥å£ã€‚æ­¤è§’è‰²å®šä¹‰äº†çœŸå®ä¸»é¢˜è§’è‰²å’Œä»£ç†ä¸»é¢˜è§’è‰²å…±ç”¨çš„æ¥å£ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä½¿ç”¨çœŸå®ä¸»é¢˜è§’è‰²çš„åœ°æ–¹ä½¿ç”¨ä»£ç†ä¸»é¢˜è§’è‰²ã€‚</li>
  <li>çœŸå®ä¸»é¢˜è§’è‰²(RealSubject)ï¼šéšè—åœ¨ä»£ç†è§’è‰²åé¢çš„çœŸå®å¯¹è±¡ã€‚</li>
  <li>ä»£ç†ä¸»é¢˜è§’è‰²(ProxySubject)ï¼šå®ƒçš„ä½œç”¨æ˜¯ä»£ç†çœŸå®ä¸»é¢˜ï¼Œåœ¨å…¶å†…éƒ¨ä¿ç•™äº†å¯¹çœŸå®ä¸»é¢˜è§’è‰²çš„å¼•ç”¨ã€‚å®ƒä¸çœŸå®ä¸»é¢˜è§’è‰²éƒ½ç»§æ‰¿è‡ªæŠ½è±¡ä¸»é¢˜è§’è‰²ï¼Œä¿æŒæ¥å£çš„ç»Ÿä¸€ã€‚å®ƒå¯ä»¥æ§åˆ¶å¯¹çœŸå®ä¸»é¢˜çš„å­˜å–ï¼Œå¹¶å¯èƒ½è´Ÿè´£åˆ›å»ºå’Œåˆ é™¤çœŸå®å¯¹è±¡ã€‚ä»£ç†è§’è‰²å¹¶ä¸æ˜¯ç®€å•çš„è½¬å‘ï¼Œé€šå¸¸åœ¨å°†è°ƒç”¨ä¼ é€’ç»™çœŸå®å¯¹è±¡ä¹‹å‰æˆ–ä¹‹åæ‰§è¡ŒæŸäº›æ“ä½œï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åªæ˜¯ç®€å•çš„è½¬å‘ã€‚ ä¸é€‚é…å™¨æ¨¡å¼ç›¸æ¯”ï¼šé€‚é…å™¨æ¨¡å¼æ˜¯ä¸ºäº†æ”¹å˜å¯¹è±¡çš„æ¥å£ï¼Œè€Œä»£ç†æ¨¡å¼å¹¶ä¸èƒ½æ”¹å˜æ‰€ä»£ç†å¯¹è±¡çš„æ¥å£ã€‚</li>
</ul>

<h3 id="é€‚ç”¨æ€§-10">é€‚ç”¨æ€§</h3>

<ul>
  <li>ä¸ºä¸€äº›å¤æ‚çš„å­ç³»ç»Ÿæä¾›ä¸€ç»„æ¥å£</li>
  <li>æé«˜å­ç³»ç»Ÿçš„ç‹¬ç«‹æ€§</li>
  <li>åœ¨å±‚æ¬¡åŒ–ç»“æ„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é—¨é¢æ¨¡å¼å®šä¹‰ç³»ç»Ÿçš„æ¯ä¸€å±‚çš„æ¥å£</li>
</ul>

<h3 id="ç±»å›¾-10">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-proxy-pattern-uml.png" alt="proxy pattern" /></p>

<h3 id="å®ä¾‹-10">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Subject</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡ä¸»é¢˜è§’è‰²</span>
    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">action</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">RealSubject</span> <span class="k">extends</span> <span class="nx">Subject</span> <span class="p">{</span> <span class="c1">// çœŸå®ä¸»é¢˜è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">action</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ProxySubject</span> <span class="k">extends</span> <span class="nx">Subject</span> <span class="p">{</span> <span class="c1">// ä»£ç†ä¸»é¢˜è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_real_subject</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">action</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_beforeAction</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_real_subject</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_real_subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RealSubject</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_real_subject</span><span class="o">-&gt;</span><span class="na">action</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_afterAction</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">_beforeAction</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">_afterAction</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProxySubject</span><span class="p">();</span>
<span class="nv">$subject</span><span class="o">-&gt;</span><span class="na">action</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="å‚è€ƒ-11">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Proxy_pattern">Wikipedia: Proxy pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F">Wikipedia: ä»£ç†æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2011/10/php-design-pattern-proxy-and-reflection/">ä»£ç†æ¨¡å¼(Proxy)å’ŒPHPçš„åå°„åŠŸèƒ½</a></li>
</ol>

<h2 id="ç­–ç•¥æ¨¡å¼strategy-pattern">ç­–ç•¥æ¨¡å¼ï¼ˆStrategy patternï¼‰</h2>
<p>ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒå®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼å¯ä»¥ä½¿ç®—æ³•å¯ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-7">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡ç­–ç•¥(Strategyï¼‰è§’è‰²ï¼šå®šä¹‰æ‰€æœ‰æ”¯æŒçš„ç®—æ³•çš„å…¬å…±æ¥å£ã€‚é€šå¸¸æ˜¯ä»¥ä¸€ä¸ªæ¥å£æˆ–æŠ½è±¡æ¥å®ç°ã€‚Contextä½¿ç”¨è¿™ä¸ªæ¥å£æ¥è°ƒç”¨å…¶ConcreteStrategyå®šä¹‰çš„ç®—æ³•</li>
  <li>å…·ä½“ç­–ç•¥(ConcreteStrategy)è§’è‰²ï¼šä»¥Strategyæ¥å£å®ç°æŸå…·ä½“ç®—æ³•</li>
  <li>ç¯å¢ƒ(Context)è§’è‰²ï¼šæŒæœ‰ä¸€ä¸ªStrategyç±»çš„å¼•ç”¨ï¼Œç”¨ä¸€ä¸ªConcreteStrategyå¯¹è±¡æ¥é…ç½®</li>
</ul>

<h3 id="é€‚ç”¨æ€§-11">é€‚ç”¨æ€§</h3>

<ul>
  <li>è®¸å¤šç›¸å…³çš„ç±»ä»…ä»…æ˜¯è¡Œä¸ºæœ‰å¼‚ã€‚â€œç­–ç•¥â€æä¾›äº†ä¸€ç§ç”¨å¤šä¸ªè¡Œä¸ºä¸­çš„ä¸€ä¸ªè¡Œä¸ºæ¥é…ç½®ä¸€ä¸ªç±»çš„æ–¹æ³•</li>
  <li>éœ€è¦ä½¿ç”¨ä¸€ä¸ªç®—æ³•çš„ä¸åŒå˜ä½“ã€‚</li>
  <li>ç®—æ³•ä½¿ç”¨å®¢æˆ·ä¸åº”è¯¥çŸ¥é“çš„æ•°æ®ã€‚å¯ä½¿ç”¨ç­–ç•¥æ¨¡å¼ä»¥é¿å…æš´éœ²å¤æ‚çš„ï¼Œä¸ç®—æ³•ç›¸å…³çš„æ•°æ®ç»“æ„</li>
  <li>ä¸€ä¸ªç±»å®šä¹‰äº†å¤šç§è¡Œä¸ºï¼Œå¹¶ä¸” è¿™äº›è¡Œä¸ºåœ¨è¿™ä¸ªç±»çš„æ“ä½œä¸­ä»¥å¤šä¸ªå½¢å¼å‡ºç°ã€‚å°†ç›¸å…³çš„æ¡ä»¶åˆ†æ”¯ç§»å’Œå®ƒä»¬å„è‡ªçš„Strategyç±»ä¸­ä»¥ä»£æ›¿è¿™äº›æ¡ä»¶è¯­å¥</li>
</ul>

<h3 id="ç±»å›¾-11">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-strategy-pattern-uml.jpg" alt="strategy pattern" /></p>

<h3 id="å®ä¾‹-11">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">interface</span> <span class="nc">Strategy</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡ç­–ç•¥è§’è‰²ï¼Œä»¥æ¥å£å®ç°</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">algorithmInterface</span><span class="p">();</span> <span class="c1">// ç®—æ³•æ¥å£</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteStrategyA</span> <span class="k">implements</span> <span class="nx">Strategy</span> <span class="p">{</span> <span class="c1">// å…·ä½“ç­–ç•¥è§’è‰²A</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">algorithmInterface</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteStrategyB</span> <span class="k">implements</span> <span class="nx">Strategy</span> <span class="p">{</span> <span class="c1">// å…·ä½“ç­–ç•¥è§’è‰²B</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">algorithmInterface</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteStrategyC</span> <span class="k">implements</span> <span class="nx">Strategy</span> <span class="p">{</span> <span class="c1">// å…·ä½“ç­–ç•¥è§’è‰²C</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">algorithmInterface</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Context</span> <span class="p">{</span> <span class="c1">// ç¯å¢ƒè§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_strategy</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Strategy</span> <span class="nv">$strategy</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_strategy</span> <span class="o">=</span> <span class="nv">$strategy</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">contextInterface</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_strategy</span><span class="o">-&gt;</span><span class="na">algorithmInterface</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$strategyA</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteStrategyA</span><span class="p">();</span>
<span class="nv">$context</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Context</span><span class="p">(</span><span class="nv">$strategyA</span><span class="p">);</span>
<span class="nv">$context</span><span class="o">-&gt;</span><span class="na">contextInterface</span><span class="p">();</span>

<span class="nv">$strategyB</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteStrategyB</span><span class="p">();</span>
<span class="nv">$context</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Context</span><span class="p">(</span><span class="nv">$strategyB</span><span class="p">);</span>
<span class="nv">$context</span><span class="o">-&gt;</span><span class="na">contextInterface</span><span class="p">();</span>

<span class="nv">$strategyC</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteStrategyC</span><span class="p">();</span>
<span class="nv">$context</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Context</span><span class="p">(</span><span class="nv">$strategyC</span><span class="p">);</span>
<span class="nv">$context</span><span class="o">-&gt;</span><span class="na">contextInterface</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-8">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-9">ä¼˜ç‚¹</h4>

<ul>
  <li>ç­–ç•¥æ¨¡å¼æä¾›äº†ç®¡ç†ç›¸å…³çš„ç®—æ³•æ—çš„åŠæ³•</li>
  <li>ç­–ç•¥æ¨¡å¼æä¾›äº†å¯ä»¥æ›¿æ¢ç»§æ‰¿å…³ç³»çš„åŠæ³• å°†ç®—å°é—­åœ¨ç‹¬ç«‹çš„Strategyç±»ä¸­ä½¿å¾—ä½ å¯ä»¥ç‹¬ç«‹äºå…¶Contextæ”¹å˜å®ƒ</li>
  <li>ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è½¬ç§»è¯­å¥ã€‚</li>
</ul>

<h4 id="ç¼ºç‚¹-7">ç¼ºç‚¹</h4>

<ul>
  <li>å®¢æˆ·å¿…é¡»äº†è§£æ‰€æœ‰çš„ç­–ç•¥ è¿™æ˜¯ç­–ç•¥æ¨¡å¼ä¸€ä¸ªæ½œåœ¨çš„ç¼ºç‚¹</li>
  <li>Strategyå’ŒContextä¹‹é—´çš„é€šä¿¡å¼€é”€</li>
  <li>ç­–ç•¥æ¨¡å¼ä¼šé€ æˆå¾ˆå¤šçš„ç­–ç•¥ç±»</li>
</ul>

<h3 id="å‚è€ƒ-12">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Strategy_pattern">Wikipedia: Strategy pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F">Wikipedia: ç­–ç•¥æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/07/php-design-pattern-12-strategy/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°ç­–ç•¥æ¨¡å¼</a></li>
</ol>

<h2 id="å‘½ä»¤æ¨¡å¼command-pattern">å‘½ä»¤æ¨¡å¼ï¼ˆCommand patternï¼‰</h2>
<p>å‘½ä»¤æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿ç”¨ä½ å¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼›å¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤æ¶ˆçš„æ“ä½œã€‚å‘½ä»¤æ¨¡å¼æŠŠå‘å‡ºå‘½ä»¤çš„è´£ä»»å’Œæ‰§è¡Œå‘½ä»¤çš„è´£ä»»åˆ†å‰²å¼€ï¼Œå§”æ´¾ç»™ä¸åŒçš„å¯¹è±¡ã€‚</p>

<p>è¯·æ±‚çš„ä¸€æ–¹å‘å‡ºè¯·æ±‚è¦æ±‚æ‰§è¡Œä¸€ä¸ªæ“ä½œï¼›æ¥æ”¶çš„ä¸€æ–¹æ”¶åˆ°è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ“ä½œã€‚å‘½ä»¤æ¨¡å¼å…è®¸è¯·æ±‚çš„ä¸€æ–¹å’Œæ¥æ”¶çš„ä¸€æ–¹ç‹¬ç«‹å¼€æ¥ï¼Œä½¿å¾—è¯·æ±‚çš„ä¸€æ–¹ä¸å¿…çŸ¥é“æ¥æ”¶è¯·æ±‚çš„ä¸€æ–¹çš„æ¥å£ï¼Œæ›´ä¸å¿…çŸ¥é“è¯·æ±‚æ˜¯æ€ä¹ˆè¢«æ¥æ”¶ï¼Œä»¥åŠæ“ä½œæ˜¯å¦è¢«æ‰§è¡Œã€ä½•æ—¶è¢«æ‰§è¡Œï¼Œä»¥åŠæ˜¯æ€ä¹ˆè¢«æ‰§è¡Œçš„ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-8">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>å‘½ä»¤ï¼ˆCommandï¼‰è§’è‰²ï¼šå£°æ˜äº†ä¸€ä¸ªç»™æ‰€æœ‰å…·ä½“å‘½ä»¤ç±»çš„æŠ½è±¡æ¥å£ã€‚è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡è§’è‰²ã€‚</li>
  <li>å…·ä½“å‘½ä»¤ï¼ˆConcreteCommandï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæ¥å—è€…å’Œè¡Œä¸ºä¹‹é—´çš„å¼±è€¦åˆï¼›å®ç°Execute()æ–¹æ³•ï¼Œè´Ÿè´£è°ƒç”¨æ¥æ”¶è€ƒçš„ç›¸åº”æ“ä½œã€‚Execute()æ–¹æ³•é€šå¸¸å«åšæ‰§è¡Œæ–¹æ³•ã€‚</li>
  <li>å®¢æˆ·ï¼ˆClientï¼‰è§’è‰²ï¼šåˆ›å»ºäº†ä¸€ä¸ªå…·ä½“å‘½ä»¤(ConcreteCommand)å¯¹è±¡å¹¶ç¡®å®šå…¶æ¥æ”¶è€…ã€‚</li>
  <li>è¯·æ±‚è€…ï¼ˆInvokerï¼‰è§’è‰²ï¼šè´Ÿè´£è°ƒç”¨å‘½ä»¤å¯¹è±¡æ‰§è¡Œè¯·æ±‚ï¼Œç›¸å…³çš„æ–¹æ³•å«åšè¡ŒåŠ¨æ–¹æ³•ã€‚</li>
  <li>æ¥æ”¶è€…ï¼ˆReceiverï¼‰è§’è‰²ï¼šè´Ÿè´£å…·ä½“å®æ–½å’Œæ‰§è¡Œä¸€ä¸ªè¯·æ±‚ã€‚ä»»ä½•ä¸€ä¸ªç±»éƒ½å¯ä»¥æˆä¸ºæ¥æ”¶è€…ï¼Œå®æ–½å’Œæ‰§è¡Œè¯·æ±‚çš„æ–¹æ³•å«åšè¡ŒåŠ¨æ–¹æ³•ã€‚</li>
</ul>

<h3 id="é€‚ç”¨æ€§-12">é€‚ç”¨æ€§</h3>

<ul>
  <li>æŠ½è±¡å‡ºå¾…æ‰§è¡Œçš„åŠ¨ä½œä»¥å‚æ•°åŒ–å¯¹è±¡ã€‚Commandæ¨¡å¼æ˜¯å›è°ƒæœºåˆ¶çš„ä¸€ä¸ªé¢å‘å¯¹è±¡çš„æ›¿ä»£å“ã€‚</li>
  <li>åœ¨ä¸åŒçš„æ—¶åˆ»æŒ‡å®šã€æ’åˆ—å’Œæ‰§è¡Œè¯·æ±‚ã€‚</li>
  <li>æ”¯æŒå–æ¶ˆæ“ä½œã€‚</li>
  <li>æ”¯æŒä¿®æ”¹æ—¥å¿—ã€‚</li>
  <li>ç”¨æ„å»ºåœ¨åŸè¯­æ“ä½œä¸Šçš„é«˜å±‚æ“ä½œæ„é€ ä¸€ä¸ªç³»ç»Ÿã€‚Commandæ¨¡å¼æä¾›äº†å¯¹äº‹åŠ¡è¿›è¡Œå»ºæ¨¡çš„æ–¹æ³•ã€‚Commandæœ‰ä¸€ä¸ªå…¬å…±çš„æ¥å£ï¼Œä½¿å¾—ä½ å¯ä»¥ç”¨åŒä¸€ç§æ–¹å¼è°ƒç”¨æ‰€æœ‰çš„äº‹åŠ¡ã€‚åŒæ—¶ä½¿ç”¨è¯¥æ¨¡å¼ä¹Ÿæ˜“äºæ·»åŠ æ–°äº‹åŠ¡ä»¥æ‰©å±•ç³»ç»Ÿã€‚</li>
</ul>

<h3 id="ç±»å›¾-12">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-command-pattern-uml.jpg" alt="command pattern" /></p>

<h3 id="å®ä¾‹-12">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">interface</span> <span class="nc">Command</span> <span class="p">{</span> <span class="c1">// å‘½ä»¤è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">();</span> <span class="c1">// æ‰§è¡Œæ–¹æ³•</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteCommand</span> <span class="k">implements</span> <span class="nx">Command</span> <span class="p">{</span> <span class="c1">// å…·ä½“å‘½ä»¤æ–¹æ³•</span>
    <span class="k">private</span> <span class="nv">$_receiver</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Receiver</span> <span class="nv">$receiver</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_receiver</span> <span class="o">=</span> <span class="nv">$receiver</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_receiver</span><span class="o">-&gt;</span><span class="na">action</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Receiver</span> <span class="p">{</span> <span class="c1">// æ¥æ”¶è€…è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_name</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">action</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Invoker</span> <span class="p">{</span> <span class="c1">// è¯·æ±‚è€…è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_command</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Command</span> <span class="nv">$command</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_command</span> <span class="o">=</span> <span class="nv">$command</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">action</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_command</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$receiver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Receiver</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">);</span>
<span class="nv">$command</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteCommand</span><span class="p">(</span><span class="nv">$receiver</span><span class="p">);</span>
<span class="nv">$invoker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Invoker</span><span class="p">(</span><span class="nv">$command</span><span class="p">);</span>
<span class="nv">$invoker</span><span class="o">-&gt;</span><span class="na">action</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-9">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-10">ä¼˜ç‚¹</h4>

<ul>
  <li>å‘½ä»¤æ¨¡å¼æŠŠè¯·æ±‚ä¸€ä¸ªæ“ä½œçš„å¯¹è±¡ä¸çŸ¥é“æ€ä¹ˆæ‰§è¡Œä¸€ä¸ªæ“ä½œçš„å¯¹è±¡åˆ†ç¦»å¼€ã€‚</li>
  <li>å‘½ä»¤ç±»ä¸å…¶ä»–ä»»ä½•åˆ«çš„ç±»ä¸€æ ·ï¼Œå¯ä»¥ä¿®æ”¹å’Œæ¨å¹¿ã€‚</li>
  <li>å¯ä»¥æŠŠå‘½ä»¤å¯¹è±¡èšåˆåœ¨ä¸€èµ·ï¼Œåˆæˆä¸ºåˆæˆå‘½ä»¤ã€‚</li>
  <li>å¯ä»¥å¾ˆå®¹æ˜“çš„åŠ å…¥æ–°çš„å‘½ä»¤ç±»ã€‚</li>
</ul>

<h4 id="ç¼ºç‚¹-8">ç¼ºç‚¹</h4>

<ul>
  <li>å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ã€‚</li>
</ul>

<h3 id="å‚è€ƒ-13">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Command_pattern">Wikipedia: Command pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F">Wikipedia: å‘½ä»¤æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/08/php-design-pattern-15-comman/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°å‘½ä»¤æ¨¡å¼</a></li>
</ol>

<h2 id="è§£é‡Šå™¨æ¨¡å¼interpreter-pattern">è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreter patternï¼‰</h2>
<p>è§£é‡Šå™¨æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒç»™å®šä¸€ä¸ªè¯­è¨€, å®šä¹‰å®ƒçš„æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨, è¯¥è§£é‡Šå™¨ä½¿ç”¨è¯¥è¡¨ç¤ºæ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚</p>

<h3 id="ç±»å›¾-13">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-interpreter-pattern-uml.jpg" alt="interpreter pattern" /></p>

<h3 id="å®ä¾‹-13">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">Expression</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">interpreter</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$str</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ExpressionNum</span> <span class="k">extends</span> <span class="nx">Expression</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">interpreter</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s2">"0"</span><span class="o">:</span> <span class="k">return</span> <span class="s2">"é›¶"</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">"1"</span><span class="o">:</span> <span class="k">return</span> <span class="s2">"ä¸€"</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">"2"</span><span class="o">:</span> <span class="k">return</span> <span class="s2">"äºŒ"</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">"3"</span><span class="o">:</span> <span class="k">return</span> <span class="s2">"ä¸‰"</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">"4"</span><span class="o">:</span> <span class="k">return</span> <span class="s2">"å››"</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">"5"</span><span class="o">:</span> <span class="k">return</span> <span class="s2">"äº”"</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">"6"</span><span class="o">:</span> <span class="k">return</span> <span class="s2">"å…­"</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">"7"</span><span class="o">:</span> <span class="k">return</span> <span class="s2">"ä¸ƒ"</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">"8"</span><span class="o">:</span> <span class="k">return</span> <span class="s2">"å…«"</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">"9"</span><span class="o">:</span> <span class="k">return</span> <span class="s2">"ä¹"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ExpressionCharater</span> <span class="k">extends</span> <span class="nx">Expression</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">interpreter</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Interpreter</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">execute</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$expression</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="nv">$i</span><span class="o">&lt;</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$temp</span> <span class="o">=</span> <span class="nv">$string</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
            <span class="k">switch</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$temp</span><span class="p">)</span><span class="o">:</span> <span class="nv">$expression</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ExpressionNum</span><span class="p">();</span> <span class="k">break</span><span class="p">;</span>
                <span class="k">default</span><span class="o">:</span> <span class="nv">$expression</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ExpressionCharater</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">echo</span> <span class="nv">$expression</span><span class="o">-&gt;</span><span class="na">interpreter</span><span class="p">(</span><span class="nv">$temp</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//client</span>
<span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Interpreter</span><span class="p">();</span>
<span class="nv">$obj</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="s2">"12345abc"</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="å‚è€ƒ-14">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Strategy_pattern">Wikipedia: Strategy pattern</a></li>
  <li><a href="http://www.jb51.net/article/27484.htm">phpè®¾è®¡æ¨¡å¼ Interpreter(è§£é‡Šå™¨æ¨¡å¼)</a></li>
</ol>

<h2 id="è¿­ä»£å™¨æ¨¡å¼iterator-pattern">è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator patternï¼‰</h2>
<p>è¿­ä»£å™¨æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ç§æœ€ç®€å•ä¹Ÿæœ€å¸¸è§çš„è®¾è®¡æ¨¡å¼ã€‚å®ƒå¯ä»¥è®©ä½¿ç”¨è€…é€è¿‡ç‰¹å®šçš„æ¥å£å·¡è®¿å®¹å™¨ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ è€Œä¸ç”¨äº†è§£åº•å±‚çš„å®ä½œã€‚</p>

<h3 id="é€‚ç”¨æ€§-13">é€‚ç”¨æ€§</h3>

<ul>
  <li>åœ¨å¸Œæœ›åˆ©ç”¨è¯­è¨€æœ¬èº«çš„éå†å‡½æ•°ä¾¿åˆ©è‡ªå®šä¹‰ç»“æ„æ—¶ï¼Œä¾‹å¦‚PHPä¸­çš„foreachå‡½æ•°</li>
</ul>

<h3 id="å®ä¾‹-14">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">sample</span> <span class="k">implements</span> <span class="nx">Iterator</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$_items</span> <span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_items</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">current</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">current</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_items</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">next</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_items</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">key</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">key</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_items</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">rewind</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">reset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_items</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">valid</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">current</span><span class="p">()</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="nv">$sa</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sample</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$sa</span> <span class="nx">AS</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$key</span><span class="p">,</span> <span class="s1">' '</span><span class="p">,</span> <span class="nv">$row</span><span class="p">,</span> <span class="s1">'&lt;br /&gt;'</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="å‚è€ƒ-15">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Iterator_pattern">Wikipedia: Iterator pattern</a></li>
  <li><a href="http://www.phppan.com/2010/04/php-iterator-and-yii-cmapiterator/">PHPä¸­è¿­ä»£å™¨çš„ç®€å•å®ç°åŠYiiæ¡†æ¶ä¸­çš„è¿­ä»£å™¨å®ç°</a></li>
</ol>

<h2 id="ä¸­ä»‹è€…æ¨¡å¼mediator-pattern">ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator patternï¼‰</h2>
<p>ä¸­ä»‹è€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒåŒ…è£…äº†ä¸€ç³»åˆ—å¯¹è±¡ç›¸äº’ä½œç”¨çš„æ–¹å¼ï¼Œä½¿å¾—è¿™äº›å¯¹è±¡ä¸å¿…ç›¸äº’æ˜æ˜¾ä½œç”¨ï¼Œä»è€Œä½¿å®ƒä»¬å¯ä»¥æ¾æ•£å¶åˆã€‚å½“æŸäº›å¯¹è±¡ä¹‹é—´çš„ä½œç”¨å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¸ä¼šç«‹å³å½±å“å…¶ä»–çš„ä¸€äº›å¯¹è±¡ä¹‹é—´çš„ä½œç”¨ï¼Œä¿è¯è¿™äº›ä½œç”¨å¯ä»¥å½¼æ­¤ç‹¬ç«‹çš„å˜åŒ–ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-9">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>ä¸­ä»‹è€…(Mediatorï¼‰è§’è‰²ï¼šå®šä¹‰äº†å¯¹è±¡é—´ç›¸äº’ä½œç”¨çš„æ¥å£</li>
  <li>å…·ä½“ä¸­ä»‹è€…(ConcreteMediator)è§’è‰²ï¼šå®ç°äº†ä¸­ä»‹è€…å®šä¹‰çš„æ¥å£ã€‚</li>
  <li>å…·ä½“å¯¹è±¡(ConcreteColleague)è§’è‰²ï¼šé€šè¿‡ä¸­ä»‹è€…å’Œåˆ«çš„å¯¹è±¡è¿›è¡Œäº¤äº’</li>
</ul>

<h3 id="å®ä¾‹-15">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Mediator</span> <span class="p">{</span> <span class="c1">// ä¸­ä»‹è€…è§’è‰²</span>
    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">send</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="nv">$colleague</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Colleague</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡å¯¹è±¡</span>
    <span class="k">private</span> <span class="nv">$_mediator</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$mediator</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mediator</span> <span class="o">=</span> <span class="nv">$mediator</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">send</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mediator</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">notify</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteMediator</span> <span class="k">extends</span> <span class="nx">Mediator</span> <span class="p">{</span> <span class="c1">// å…·ä½“ä¸­ä»‹è€…è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_colleague1</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$_colleague2</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">send</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span><span class="nv">$colleague</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$colleague</span> <span class="o">==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_colleague1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_colleague1</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_colleague2</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">set</span><span class="p">(</span><span class="nv">$colleague1</span><span class="p">,</span><span class="nv">$colleague2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_colleague1</span> <span class="o">=</span> <span class="nv">$colleague1</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_colleague2</span> <span class="o">=</span> <span class="nv">$colleague2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Colleague1</span> <span class="k">extends</span> <span class="nx">Colleague</span> <span class="p">{</span> <span class="c1">// å…·ä½“å¯¹è±¡è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">notify</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Colleague2</span> <span class="k">extends</span> <span class="nx">Colleague</span> <span class="p">{</span> <span class="c1">// å…·ä½“å¯¹è±¡è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">notify</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$objMediator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteMediator</span><span class="p">();</span>
<span class="nv">$objC1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Colleague1</span><span class="p">(</span><span class="nv">$objMediator</span><span class="p">);</span>
<span class="nv">$objC2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Colleague2</span><span class="p">(</span><span class="nv">$objMediator</span><span class="p">);</span>
<span class="nv">$objMediator</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nv">$objC1</span><span class="p">,</span><span class="nv">$objC2</span><span class="p">);</span>
<span class="nv">$objC1</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s2">"to c2 from c1"</span><span class="p">);</span>
<span class="nv">$objC2</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="s2">"to c1 from c2"</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="å‚è€ƒ-16">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Mediator_pattern">Wikipedia: Mediator pattern</a></li>
</ol>

<h2 id="å¤‡å¿˜å½•æ¨¡å¼memento-pattern">å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento patternï¼‰</h2>
<p>å¤‡å¿˜å½•æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒåœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™æ ·å¯ä»¥åœ¨ä»¥åæŠŠè¯¥å¯¹è±¡çš„çŠ¶æ€æ¢å¤åˆ°ä¹‹å‰ä¿å­˜çš„çŠ¶æ€ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-10">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>å¤‡å¿˜å½•(Memento)è§’è‰²ï¼šå­˜å‚¨å‘èµ·äºº(Originator)å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œè€Œå‘èµ·äººæ ¹æ®éœ€è¦å†³å®šå¤‡å¿˜å½•å­˜å‚¨å‘èµ·äººçš„å“ªäº›å†…éƒ¨çŠ¶æ€ã€‚å¤‡å¿˜å½•å¯ä»¥ä¿æŠ¤å…¶å†…å®¹ä¸è¢«å‘èµ·äºº(Originator)å¯¹è±¡ä¹‹å¤–çš„ä»»ä½•å¯¹è±¡æ‰€è¯»å–ã€‚</li>
  <li>å‘èµ·äºº(Originator)è§’è‰²ï¼šåˆ›å»ºä¸€ä¸ªå«æœ‰å½“å‰çš„å†…éƒ¨çŠ¶æ€çš„å¤‡å¿˜å½•å¯¹è±¡ï¼Œä½¿ç”¨å¤‡å¿˜å½•å¯¹è±¡å­˜å‚¨å…¶å†…éƒ¨çŠ¶æ€</li>
  <li>è´Ÿè´£äºº(Caretaker)è§’è‰²ï¼šè´Ÿè´£ä¿å­˜å¤‡å¿˜å½•å¯¹è±¡ï¼Œä¸æ£€æŸ¥å¤‡å¿˜å½•å¯¹è±¡çš„å†…å®¹</li>
</ul>

<h3 id="é€‚ç”¨æ€§-14">é€‚ç”¨æ€§</h3>

<ul>
  <li>å¿…é¡»ä¿å­˜ä¸€ä¸ªå¯¹è±¡åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„ï¼ˆéƒ¨åˆ†ï¼‰çŠ¶æ€ï¼Œè¿™æ ·ä»¥åéœ€è¦æ—¶å®ƒæ‰èƒ½æ¢å¤åˆ°å…ˆå‰çš„çŠ¶æ€ã€‚</li>
  <li>å¦‚æœä¸€ä¸ªç”¨æ¥å£æ¥è®©å…¶å®ƒå¯¹è±¡ç›´æ¥å¾—åˆ°è¿™äº›çŠ¶æ€ï¼Œå°†ä¼šæš´éœ²å¯¹è±¡çš„å®ç°ç»†èŠ‚å¹¶ç ´åå¯¹è±¡çš„å°è£…æ€§ã€‚</li>
</ul>

<h3 id="ç±»å›¾-14">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-memento-pattern-uml.jpg" alt="memento pattern" /></p>

<h3 id="å®ä¾‹-16">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">Originator</span> <span class="p">{</span> <span class="c1">// å‘èµ·äºº(Originator)è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_state</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_state</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createMemento</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// åˆ›å»ºå¤‡å¿˜å½•</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Memento</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_state</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">restoreMemento</span><span class="p">(</span><span class="nx">Memento</span> <span class="nv">$memento</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// å°†å‘èµ·äººæ¢å¤åˆ°å¤‡å¿˜å½•å¯¹è±¡è®°å½•çš„çŠ¶æ€ä¸Š</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_state</span> <span class="o">=</span> <span class="nv">$memento</span><span class="o">-&gt;</span><span class="na">getState</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setState</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_state</span> <span class="o">=</span> <span class="nv">$state</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getState</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_state</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showState</span><span class="p">()</span> <span class="p">{}</span>

<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Memento</span> <span class="p">{</span> <span class="c1">// å¤‡å¿˜å½•(Memento)è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_state</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setState</span><span class="p">(</span><span class="nv">$state</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getState</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_state</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setState</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_state</span> <span class="o">=</span> <span class="nv">$state</span><span class="p">;}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Caretaker</span> <span class="p">{</span> <span class="c1">// è´Ÿè´£äºº(Caretaker)è§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_memento</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getMemento</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_memento</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setMemento</span><span class="p">(</span><span class="nx">Memento</span> <span class="nv">$memento</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_memento</span> <span class="o">=</span> <span class="nv">$memento</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="cm">/* åˆ›å»ºç›®æ ‡å¯¹è±¡ */</span>
<span class="nv">$org</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Originator</span><span class="p">();</span>
<span class="nv">$org</span><span class="o">-&gt;</span><span class="na">setState</span><span class="p">(</span><span class="s1">'open'</span><span class="p">);</span>
<span class="nv">$org</span><span class="o">-&gt;</span><span class="na">showState</span><span class="p">();</span>

<span class="cm">/* åˆ›å»ºå¤‡å¿˜ */</span>
<span class="nv">$memento</span> <span class="o">=</span> <span class="nv">$org</span><span class="o">-&gt;</span><span class="na">createMemento</span><span class="p">();</span>

<span class="cm">/* é€šè¿‡Caretakerä¿å­˜æ­¤å¤‡å¿˜ */</span>
<span class="nv">$caretaker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Caretaker</span><span class="p">();</span>
<span class="nv">$caretaker</span><span class="o">-&gt;</span><span class="na">setMemento</span><span class="p">(</span><span class="nv">$memento</span><span class="p">);</span>

<span class="cm">/* æ”¹å˜ç›®æ ‡å¯¹è±¡çš„çŠ¶æ€ */</span>
<span class="nv">$org</span><span class="o">-&gt;</span><span class="na">setState</span><span class="p">(</span><span class="s1">'close'</span><span class="p">);</span>
<span class="nv">$org</span><span class="o">-&gt;</span><span class="na">showState</span><span class="p">();</span>

<span class="cm">/* è¿˜åŸæ“ä½œ */</span>
<span class="nv">$org</span><span class="o">-&gt;</span><span class="na">restoreMemento</span><span class="p">(</span><span class="nv">$caretaker</span><span class="o">-&gt;</span><span class="na">getMemento</span><span class="p">());</span>
<span class="nv">$org</span><span class="o">-&gt;</span><span class="na">showState</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-10">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-11">ä¼˜ç‚¹</h4>

<ul>
  <li>æœ‰æ—¶ä¸€äº›å‘èµ·äººå¯¹è±¡çš„å†…éƒ¨ä¿¡æ¯å¿…é¡»ä¿å­˜åœ¨å‘èµ·äººå¯¹è±¡ä»¥å¤–çš„åœ°æ–¹ï¼Œä½†æ˜¯å¿…é¡»è¦ç”±å‘èµ·äººå¯¹è±¡è‡ªå·±è¯»å–ã€‚</li>
  <li>ç®€åŒ–äº†å‘èµ·äºº(Originator)ç±»ã€‚å‘èµ·äºº(Originator)ä¸å†éœ€è¦ç®¡ç†å’Œä¿å­˜å…¶å†…éƒ¨çŠ¶æ€çš„ä¸€ä¸ªä¸ªç‰ˆæœ¬ï¼Œå®¢æˆ·ç«¯å¯ä»¥è‡ªè¡Œç®¡ç†å®ƒä»¬æ‰€éœ€è¦çš„è¿™äº›çŠ¶æ€çš„ç‰ˆæœ¬</li>
  <li>å½“å‘èµ·äººè§’è‰²çš„çŠ¶æ€æ”¹å˜çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½è¿™ä¸ªçŠ¶æ€æ— æ•ˆï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨æš‚æ—¶å­˜å‚¨èµ·æ¥çš„å¤‡å¿˜å½•å°†çŠ¶æ€å¤åŸã€‚</li>
</ul>

<h4 id="ç¼ºç‚¹-9">ç¼ºç‚¹</h4>

<ul>
  <li>å¦‚æœå‘èµ·äººè§’è‰²çš„çŠ¶æ€éœ€è¦å®Œæ•´åœ°å­˜å‚¨åˆ°å¤‡å¿˜å½•å¯¹è±¡ä¸­ï¼Œé‚£ä¹ˆåœ¨èµ„æºæ¶ˆè€—ä¸Šé¢å¤‡å¿˜å½•å¯¹è±¡ä¼šå¾ˆæ˜‚è´µã€‚</li>
  <li>å½“è´Ÿè´£äººè§’è‰²å°†ä¸€ä¸ªå¤‡å¿˜å½•å­˜å‚¨èµ·æ¥çš„æ—¶å€™ï¼Œè´Ÿè´£äººå¯èƒ½å¹¶ä¸çŸ¥é“è¿™ä¸ªçŠ¶æ€ä¼šå ç”¨å¤šå¤§çš„å­˜å‚¨ç©ºé—´ï¼Œä»è€Œæ— æ³•æé†’ç”¨æˆ·ä¸€ä¸ªæ“ä½œæ˜¯å¦ä¼šå¾ˆæ˜‚è´µã€‚</li>
  <li>å½“å‘èµ·äººè§’è‰²çš„çŠ¶æ€æ”¹å˜çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½è¿™ä¸ªçŠ¶æ€æ— æ•ˆã€‚</li>
</ul>

<h3 id="å‚è€ƒ-17">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Memento_pattern">Wikipedia: Memento pattern</a></li>
  <li><a href="http://www.phppan.com/2010/10/php-design-pattern-18-memento/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°å¤‡å¿˜å½•æ¨¡å¼</a></li>
</ol>

<h2 id="è®¿é—®è€…æ¨¡å¼visitor-pattern">è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor patternï¼‰</h2>
<p>è®¿é—®è€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œè®¿é—®è€…è¡¨ç¤ºä¸€ä¸ªä½œç”¨äºæŸå¯¹è±¡ç»“æ„ä¸­å„å…ƒç´ çš„æ“ä½œã€‚å®ƒå¯ä»¥åœ¨ä¸ä¿®æ”¹å„å…ƒç´ ç±»çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°æ“ä½œï¼Œå³åŠ¨æ€çš„å¢åŠ å…·ä½“è®¿é—®è€…è§’è‰²ã€‚</p>

<p>è®¿é—®è€…æ¨¡å¼åˆ©ç”¨äº†åŒé‡åˆ†æ´¾ã€‚å…ˆå°†è®¿é—®è€…ä¼ å…¥å…ƒç´ å¯¹è±¡çš„Acceptæ–¹æ³•ä¸­ï¼Œç„¶åå…ƒç´ å¯¹è±¡å†å°†è‡ªå·±ä¼ å…¥è®¿é—®è€…ï¼Œä¹‹åè®¿é—®è€…æ‰§è¡Œå…ƒç´ çš„ç›¸åº”æ–¹æ³•ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-11">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡è®¿é—®è€…è§’è‰²(Visitor)ï¼šä¸ºè¯¥å¯¹è±¡ç»“æ„(ObjectStructure)ä¸­çš„æ¯ä¸€ä¸ªå…·ä½“å…ƒç´ æä¾›ä¸€ä¸ªè®¿é—®æ“ä½œæ¥å£ã€‚è¯¥æ“ä½œæ¥å£çš„åå­—å’Œå‚æ•°æ ‡è¯†äº† è¦è®¿é—®çš„å…·ä½“å…ƒç´ è§’è‰²ã€‚è¿™æ ·è®¿é—®è€…å°±å¯ä»¥é€šè¿‡è¯¥å…ƒç´ è§’è‰²çš„ç‰¹å®šæ¥å£ç›´æ¥è®¿é—®å®ƒã€‚</li>
  <li>å…·ä½“è®¿é—®è€…è§’è‰²(ConcreteVisitor)ï¼šå®ç°æŠ½è±¡è®¿é—®è€…è§’è‰²æ¥å£ä¸­é’ˆå¯¹å„ä¸ªå…·ä½“å…ƒç´ è§’è‰²å£°æ˜çš„æ“ä½œã€‚</li>
  <li>æŠ½è±¡èŠ‚ç‚¹ï¼ˆNodeï¼‰è§’è‰²ï¼šè¯¥æ¥å£å®šä¹‰ä¸€ä¸ªacceptæ“ä½œæ¥å—å…·ä½“çš„è®¿é—®è€…ã€‚</li>
  <li>å…·ä½“èŠ‚ç‚¹ï¼ˆNodeï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡èŠ‚ç‚¹è§’è‰²ä¸­çš„acceptæ“ä½œã€‚</li>
  <li>å¯¹è±¡ç»“æ„è§’è‰²(ObjectStructure)ï¼šè¿™æ˜¯ä½¿ç”¨è®¿é—®è€…æ¨¡å¼å¿…å¤‡çš„è§’è‰²ã€‚å®ƒè¦å…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼šèƒ½æšä¸¾å®ƒçš„å…ƒç´ ï¼›å¯ä»¥æä¾›ä¸€ä¸ªé«˜å±‚çš„æ¥å£ä»¥å…è®¸è¯¥è®¿é—®è€…è®¿é—®å®ƒçš„å…ƒç´ ï¼›å¯ä»¥æ˜¯ä¸€ä¸ªå¤åˆï¼ˆç»„åˆæ¨¡å¼ï¼‰æˆ–æ˜¯ä¸€ä¸ªé›†åˆï¼Œå¦‚ä¸€ä¸ªåˆ—è¡¨æˆ–ä¸€ä¸ªæ— åºé›†åˆ(åœ¨PHPä¸­æˆ‘ä»¬ä½¿ç”¨æ•°ç»„ä»£æ›¿ï¼Œå› ä¸ºPHPä¸­çš„æ•°ç»„æœ¬æ¥å°±æ˜¯ä¸€ä¸ªå¯ä»¥æ”¾ç½®ä»»ä½•ç±»å‹æ•°æ®çš„é›†åˆ)</li>
</ul>

<h3 id="é€‚ç”¨æ€§-15">é€‚ç”¨æ€§</h3>

<ul>
  <li>è®¿é—®è€…æ¨¡å¼å¤šç”¨åœ¨èšé›†ç±»å‹å¤šæ ·çš„æƒ…å†µä¸‹ã€‚åœ¨æ™®é€šçš„å½¢å¼ä¸‹å¿…é¡»åˆ¤æ–­æ¯ä¸ªå…ƒç´ æ˜¯å±äºä»€ä¹ˆç±»å‹ç„¶åè¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œä»è€Œè¯ç”Ÿå‡ºå†—é•¿çš„æ¡ä»¶è½¬ç§»è¯­å¥ã€‚è€Œè®¿é—®è€…æ¨¡å¼åˆ™å¯ä»¥æ¯”è¾ƒå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¯¹æ¯ä¸ªå…ƒç´ ç»Ÿä¸€è°ƒç”¨$element-&gt;accept($vistor)å³å¯ã€‚</li>
  <li>è®¿é—®è€…æ¨¡å¼å¤šç”¨äºè¢«è®¿é—®çš„ç±»ç»“æ„æ¯”è¾ƒç¨³å®šçš„æƒ…å†µä¸‹ï¼Œå³ä¸ä¼šéšä¾¿æ·»åŠ å­ç±»ã€‚è®¿é—®è€…æ¨¡å¼å…è®¸è¢«è®¿é—®ç»“æ„æ·»åŠ æ–°çš„æ–¹æ³•ã€‚</li>
</ul>

<h3 id="ç±»å›¾-15">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-visitor-pattern-uml.jpg" alt="visitor pattern" /></p>

<h3 id="å®ä¾‹-17">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">interface</span> <span class="nc">Visitor</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡è®¿é—®è€…è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">visitConcreteElementA</span><span class="p">(</span><span class="nx">ConcreteElementA</span> <span class="nv">$elementA</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">visitConcreteElementB</span><span class="p">(</span><span class="nx">concreteElementB</span> <span class="nv">$elementB</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">interface</span> <span class="nc">Element</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡èŠ‚ç‚¹è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">accept</span><span class="p">(</span><span class="nx">Visitor</span> <span class="nv">$visitor</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteVisitor1</span> <span class="k">implements</span> <span class="nx">Visitor</span> <span class="p">{</span> <span class="c1">// å…·ä½“çš„è®¿é—®è€…1</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">visitConcreteElementA</span><span class="p">(</span><span class="nx">ConcreteElementA</span> <span class="nv">$elementA</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">visitConcreteElementB</span><span class="p">(</span><span class="nx">ConcreteElementB</span> <span class="nv">$elementB</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteVisitor2</span> <span class="k">implements</span> <span class="nx">Visitor</span> <span class="p">{</span> <span class="c1">// å…·ä½“çš„è®¿é—®è€…2</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">visitConcreteElementA</span><span class="p">(</span><span class="nx">ConcreteElementA</span> <span class="nv">$elementA</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">visitConcreteElementB</span><span class="p">(</span><span class="nx">ConcreteElementB</span> <span class="nv">$elementB</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteElementA</span> <span class="k">implements</span> <span class="nx">Element</span> <span class="p">{</span> <span class="c1">// å…·ä½“å…ƒç´ A</span>
    <span class="k">private</span> <span class="nv">$_name</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_name</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">accept</span><span class="p">(</span><span class="nx">Visitor</span> <span class="nv">$visitor</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// æ¥å—è®¿é—®è€…è°ƒç”¨å®ƒé’ˆå¯¹è¯¥å…ƒç´ çš„æ–°æ–¹æ³•</span>
        <span class="nv">$visitor</span><span class="o">-&gt;</span><span class="na">visitConcreteElementA</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteElementB</span> <span class="k">implements</span> <span class="nx">Element</span> <span class="p">{</span> <span class="c1">// å…·ä½“å…ƒç´ B</span>
    <span class="k">private</span> <span class="nv">$_name</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_name</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">accept</span><span class="p">(</span><span class="nx">Visitor</span> <span class="nv">$visitor</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// æ¥å—è®¿é—®è€…è°ƒç”¨å®ƒé’ˆå¯¹è¯¥å…ƒç´ çš„æ–°æ–¹æ³•</span>
        <span class="nv">$visitor</span><span class="o">-&gt;</span><span class="na">visitConcreteElementB</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ObjectStructure</span> <span class="p">{</span> <span class="c1">// å¯¹è±¡ç»“æ„ å³å…ƒç´ çš„é›†åˆ</span>
    <span class="k">private</span> <span class="nv">$_collection</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_collection</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">attach</span><span class="p">(</span><span class="nx">Element</span> <span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">array_push</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_collection</span><span class="p">,</span> <span class="nv">$element</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">detach</span><span class="p">(</span><span class="nx">Element</span> <span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$index</span> <span class="o">=</span> <span class="nb">array_search</span><span class="p">(</span><span class="nv">$element</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_collection</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$index</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_collection</span><span class="p">[</span><span class="nv">$index</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$index</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">accept</span><span class="p">(</span><span class="nx">Visitor</span> <span class="nv">$visitor</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_collection</span> <span class="k">as</span> <span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">accept</span><span class="p">(</span><span class="nv">$visitor</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$elementA</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteElementA</span><span class="p">(</span><span class="s2">"ElementA"</span><span class="p">);</span>
<span class="nv">$elementB</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteElementB</span><span class="p">(</span><span class="s2">"ElementB"</span><span class="p">);</span>
<span class="nv">$elementA2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteElementB</span><span class="p">(</span><span class="s2">"ElementA2"</span><span class="p">);</span>
<span class="nv">$visitor1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteVisitor1</span><span class="p">();</span>
<span class="nv">$visitor2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteVisitor2</span><span class="p">();</span>

<span class="nv">$os</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ObjectStructure</span><span class="p">();</span>
<span class="nv">$os</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$elementA</span><span class="p">);</span>
<span class="nv">$os</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$elementB</span><span class="p">);</span>
<span class="nv">$os</span><span class="o">-&gt;</span><span class="na">attach</span><span class="p">(</span><span class="nv">$elementA2</span><span class="p">);</span>
<span class="nv">$os</span><span class="o">-&gt;</span><span class="na">detach</span><span class="p">(</span><span class="nv">$elementA</span><span class="p">);</span>
<span class="nv">$os</span><span class="o">-&gt;</span><span class="na">accept</span><span class="p">(</span><span class="nv">$visitor1</span><span class="p">);</span>
<span class="nv">$os</span><span class="o">-&gt;</span><span class="na">accept</span><span class="p">(</span><span class="nv">$visitor2</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-11">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-12">ä¼˜ç‚¹</h4>

<ul>
  <li>è®¿é—®è€…æ¨¡å¼ä½¿å¾—å¢åŠ æ–°çš„æ“ä½œå˜å¾—å¾ˆå®¹æ˜“ã€‚ä½¿ç”¨è®¿é—®è€…æ¨¡å¼å¯ä»¥åœ¨ä¸ç”¨ä¿®æ”¹å…·ä½“å…ƒç´ ç±»çš„æƒ…å†µä¸‹å¢åŠ æ–°çš„æ“ä½œã€‚å®ƒä¸»è¦æ˜¯é€šè¿‡å…ƒç´ ç±»çš„acceptæ–¹æ³•æ¥æ¥å—ä¸€ä¸ªæ–°çš„visitorå¯¹è±¡æ¥å®ç°çš„ã€‚å¦‚æœä¸€äº›æ“ä½œä¾èµ–äºä¸€ä¸ªå¤æ‚çš„ç»“æ„å¯¹è±¡çš„è¯ï¼Œé‚£ä¹ˆä¸€èˆ¬è€Œè¨€ï¼Œå¢åŠ æ–°çš„æ“ä½œä¼šå¾ˆå¤æ‚ã€‚è€Œä½¿ç”¨è®¿é—®è€…æ¨¡å¼ï¼Œå¢åŠ æ–°çš„æ“ä½œå°±æ„å‘³ç€å¢åŠ ä¸€ä¸ªæ–°çš„è®¿é—®è€…ç±»ï¼Œå› æ­¤ï¼Œå˜å¾—å¾ˆå®¹æ˜“ã€‚</li>
  <li>è®¿é—®è€…æ¨¡å¼å°†æœ‰å…³çš„è¡Œä¸ºé›†ä¸­åˆ°ä¸€ä¸ªè®¿é—®è€…å¯¹è±¡ä¸­ï¼Œè€Œä¸æ˜¯åˆ†æ•£åˆ°ä¸€ä¸ªä¸ªçš„èŠ‚ç‚¹ç±»ä¸­ã€‚</li>
  <li>è®¿é—®è€…æ¨¡å¼å¯ä»¥è·¨è¿‡å‡ ä¸ªç±»çš„ç­‰çº§ç»“æ„è®¿é—®å±äºä¸åŒçš„ç­‰çº§ç»“æ„çš„æˆå‘˜ç±»ã€‚è¿­ä»£å­åªèƒ½è®¿é—®å±äºåŒä¸€ä¸ªç±»å‹ç­‰çº§ç»“æ„çš„æˆå‘˜å¯¹è±¡ï¼Œè€Œä¸èƒ½è®¿é—®å±äºä¸åŒç­‰çº§ç»“æ„çš„å¯¹è±¡ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</li>
  <li>ç§¯ç´¯çŠ¶æ€ã€‚æ¯ä¸€ä¸ªå•ç‹¬çš„è®¿é—®è€…å¯¹è±¡éƒ½é›†ä¸­äº†ç›¸å…³çš„è¡Œä¸ºï¼Œä»è€Œä¹Ÿå°±å¯ä»¥åœ¨è®¿é—®çš„è¿‡ç¨‹ä¸­å°†æ‰§è¡Œæ“ä½œçš„çŠ¶æ€ç§¯ç´¯åœ¨è‡ªå·±å†…éƒ¨ï¼Œè€Œä¸æ˜¯åˆ†æ•£åˆ°å¾ˆå¤šçš„èŠ‚ç‚¹å¯¹è±¡ä¸­ã€‚è¿™æ˜¯æœ‰ç›Šäºç³»ç»Ÿç»´æŠ¤çš„ä¼˜ç‚¹ã€‚</li>
</ul>

<h4 id="ç¼ºç‚¹-10">ç¼ºç‚¹</h4>

<ul>
  <li>å¢åŠ æ–°çš„èŠ‚ç‚¹ç±»å˜å¾—å¾ˆå›°éš¾ã€‚æ¯å¢åŠ ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹éƒ½æ„å‘³ç€è¦åœ¨æŠ½è±¡è®¿é—®è€…è§’è‰²ä¸­å¢åŠ ä¸€ä¸ªæ–°çš„æŠ½è±¡æ“ä½œï¼Œå¹¶åœ¨æ¯ä¸€ä¸ªå…·ä½“è®¿é—®è€…ç±»ä¸­å¢åŠ ç›¸åº”çš„å…·ä½“æ“ä½œã€‚</li>
  <li>ç ´åå°è£…ã€‚è®¿é—®è€…æ¨¡å¼è¦æ±‚è®¿é—®è€…å¯¹è±¡è®¿é—®å¹¶è°ƒç”¨æ¯ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡çš„æ“ä½œï¼Œè¿™éšå«äº†ä¸€ä¸ªå¯¹æ‰€æœ‰èŠ‚ç‚¹å¯¹è±¡çš„è¦æ±‚ï¼šå®ƒä»¬å¿…é¡»æš´éœ²ä¸€äº›è‡ªå·±çš„æ“ä½œå’Œå†…éƒ¨çŠ¶æ€ã€‚ä¸ç„¶ï¼Œè®¿é—®è€…çš„è®¿é—®å°±å˜å¾—æ²¡æœ‰æ„ä¹‰ã€‚ç”±äºè®¿é—®è€…å¯¹è±¡è‡ªå·±ä¼šç§¯ç´¯è®¿é—®æ“ä½œæ‰€éœ€çš„çŠ¶æ€ï¼Œä»è€Œä½¿è¿™äº›çŠ¶æ€ä¸å†å­˜å‚¨åœ¨èŠ‚ç‚¹å¯¹è±¡ä¸­ï¼Œè¿™ä¹Ÿæ˜¯ç ´åå°è£…çš„ã€‚</li>
</ul>

<h3 id="å‚è€ƒ-18">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Visitor_pattern">Wikipedia: Visitor pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F">Wikipedia: è®¿é—®è€…æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/05/php-design-pattern-1-visitor/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°è®¿é—®è€…æ¨¡å¼</a></li>
</ol>

<h2 id="ç­–ç•¥æ¨¡å¼strategy-pattern-1">ç­–ç•¥æ¨¡å¼ï¼ˆStrategy patternï¼‰</h2>
<p>çŠ¶æ€æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒå…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚å¯¹è±¡çœ‹èµ·æ¥ä¼¼ä¹ä¿®æ”¹äº†å®ƒçš„ç±»ï¼ŒçŠ¶æ€æ¨¡å¼å˜åŒ–çš„ä½ç½®åœ¨äºå¯¹è±¡çš„çŠ¶æ€ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-12">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡çŠ¶æ€(State)è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨ä»¥å°è£…ç¯å¢ƒå¯¹è±¡çš„ä¸€ä¸ªç‰¹å®šçš„çŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸º</li>
  <li>å…·ä½“çŠ¶æ€ï¼ˆConcreteState)è§’è‰²ï¼šæ¯ä¸€ä¸ªå…·ä½“çŠ¶æ€ç±»éƒ½å®ç°äº†ç¯å¢ƒï¼ˆContextï¼‰çš„ä¸€ä¸ªçŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸º</li>
  <li>ç¯å¢ƒ(Context)è§’è‰²ï¼šå®šä¹‰å®¢æˆ·ç«¯æ‰€æ„Ÿå…´è¶£çš„æ¥å£ï¼Œå¹¶ä¸”ä¿ç•™ä¸€ä¸ªå…·ä½“çŠ¶æ€ç±»çš„å®ä¾‹ã€‚è¿™ä¸ªå…·ä½“çŠ¶æ€ç±»çš„å®ä¾‹ç»™å‡ºæ­¤ç¯å¢ƒå¯¹è±¡çš„ç°æœ‰çŠ¶æ€</li>
</ul>

<h3 id="é€‚ç”¨æ€§-16">é€‚ç”¨æ€§</h3>

<ul>
  <li>ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸ºå–å†³äºå®ƒçš„çŠ¶æ€ï¼Œå¹¶ä¸”å®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶åˆ»æ ¹æ®çŠ¶æ€æ”¹å˜å®ƒçš„è¡Œä¸º</li>
  <li>ä¸€ä¸ªæ“ä½œä¸­å«æœ‰åºå¤§çš„å¤šåˆ†æ”¯çš„æ¡ä»¶è¯­å¥ï¼Œä¸”è¿™äº›åˆ†æ”¯ä¾èµ–äºè¯¥å¯¹è±¡çš„çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€é€šå¸¸ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªæšä¸¾å¸¸é‡è¡¨ç¤ºã€‚é€šå¸¸ï¼Œæœ‰å¤šä¸ªæ“ä½œåŒ…å«è¿™ä¸€ç›¸åŒçš„æ¡ä»¶ç»“æ„ã€‚Stateæ¨¡å¼æ¨¡å¼å°†æ¯ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯æ”¾å…¥ä¸€ä¸ªç‹¬ç«‹çš„ç±»ä¸­ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥è¦æ‰€å¯¹è±¡è‡ªèº«çš„æƒ…å†µå°†å¯¹è±¡çš„çŠ¶æ€ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸€å¯¹è±¡å¯ä»¥ä¸ä¾èµ–äºå…¶ä»–å¯¹è±¡è€Œç‹¬ç«‹å˜åŒ–</li>
</ul>

<h3 id="ç±»å›¾-16">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-state-pattern-uml.jpg" alt="state pattern" /></p>

<h3 id="å®ä¾‹-18">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">interface</span> <span class="nc">State</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡çŠ¶æ€è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Context</span> <span class="nv">$context</span><span class="p">);</span> <span class="c1">// æ–¹æ³•ç¤ºä¾‹</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteStateA</span> <span class="k">implements</span> <span class="nx">State</span> <span class="p">{</span> <span class="c1">// å…·ä½“çŠ¶æ€è§’è‰²A</span>
    <span class="k">private</span> <span class="k">static</span> <span class="nv">$_instance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getInstance</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// é™æ€å·¥å‚æ–¹æ³•ï¼Œè¿”è¿˜æ­¤ç±»çš„å”¯ä¸€å®ä¾‹</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$_instance</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">self</span><span class="o">::</span><span class="nv">$_instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteStateA</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$_instance</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Context</span> <span class="nv">$context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">setState</span><span class="p">(</span><span class="nx">ConcreteStateB</span><span class="o">::</span><span class="na">getInstance</span><span class="p">());</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteStateB</span> <span class="k">implements</span> <span class="nx">State</span> <span class="p">{</span> <span class="c1">// å…·ä½“çŠ¶æ€è§’è‰²B</span>
    <span class="k">private</span> <span class="k">static</span> <span class="nv">$_instance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getInstance</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$_instance</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">self</span><span class="o">::</span><span class="nv">$_instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteStateB</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$_instance</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Context</span> <span class="nv">$context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$context</span><span class="o">-&gt;</span><span class="na">setState</span><span class="p">(</span><span class="nx">ConcreteStateA</span><span class="o">::</span><span class="na">getInstance</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Context</span> <span class="p">{</span> <span class="c1">// ç¯å¢ƒè§’è‰²</span>
    <span class="k">private</span> <span class="nv">$_state</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// é»˜è®¤ä¸ºstateA</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_state</span> <span class="o">=</span> <span class="nx">ConcreteStateA</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setState</span><span class="p">(</span><span class="nx">State</span> <span class="nv">$state</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_state</span> <span class="o">=</span> <span class="nv">$state</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">request</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_state</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// client</span>
<span class="nv">$context</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Context</span><span class="p">();</span>
<span class="nv">$context</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">();</span>
<span class="nv">$context</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">();</span>
<span class="nv">$context</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">();</span>
<span class="nv">$context</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="ä¼˜ç¼ºç‚¹-12">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-13">ä¼˜ç‚¹</h4>

<ul>
  <li>å®ƒå°†ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„è¡Œä¸ºå±€éƒ¨åŒ–</li>
  <li>å®ƒä½¿å¾—çŠ¶æ€è½¬æ¢æ˜¾ç¤ºåŒ–</li>
  <li>Stateå¯¹è±¡å¯è¢«å…±äº«</li>
</ul>

<h3 id="å‚è€ƒ-19">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/State_pattern">Wikipedia: State pattern</a></li>
  <li><a href="http://www.phppan.com/2010/07/php-design-pattern-11-state/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°çŠ¶æ€æ¨¡å¼</a></li>
</ol>

<h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼abstract-factory-pattern">æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factory patternï¼‰</h2>
<p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥å°†ä¸€ç»„å…·æœ‰åŒä¸€ä¸»é¢˜çš„å•ç‹¬çš„å·¥å‚å°è£…èµ·æ¥ã€‚å®ƒçš„å®è´¨æ˜¯â€œæä¾›æ¥å£ï¼Œåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç‹¬ç«‹çš„å¯¹è±¡ï¼Œè€Œä¸æŒ‡å®šè¿™äº›å¯¹è±¡çš„å…·ä½“ç±»â€ã€‚</p>

<p>æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»ç»Ÿç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚</p>

<h3 id="æŠ½è±¡å·¥å‚æ¨¡å¼ä¸­ä¸»è¦è§’è‰²">æŠ½è±¡å·¥å‚æ¨¡å¼ä¸­ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡å·¥å‚(Abstract Factory)è§’è‰²ï¼šå®ƒå£°æ˜åˆ›å»ºæŠ½è±¡äº§å“å¯¹è±¡çš„æ¥å£</li>
  <li>å…·ä½“å·¥å‚(Concrete Factory)è§’è‰²ï¼šå®ç°åˆ›å»ºäº§å“å¯¹è±¡çš„æ“ä½œ</li>
  <li>æŠ½è±¡äº§å“(Abstract Product)è§’è‰²ï¼šå£°æ˜ä¸€ç±»äº§å“çš„æ¥å£</li>
  <li>å…·ä½“äº§å“(Concrete Product)è§’è‰²ï¼šå®ç°æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£</li>
</ul>

<p>è¿™ä¸ªå’Œå·¥å‚æ–¹æ³•æ¨¡å¼ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¸å†åªè¦ä¸€ä¸ªæ±‰å ¡ï¼Œå¯èƒ½æ˜¯4ä¸ªæ±‰å ¡2ä¸ªé¸¡ç¿…ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯¹æœåŠ¡å‘˜è¯´ï¼ŒæœåŠ¡å‘˜å±äºå…·ä½“å·¥å‚ï¼ŒæŠ½è±¡äº§å“å°±æ˜¯éº¦å½“åŠ³å¯å–çš„é£Ÿç‰©ï¼Œå…·ä½“äº§å“æ˜¯æˆ‘ä»¬è·ŸæœåŠ¡å‘˜è¦çš„é£Ÿç‰©ã€‚</p>

<h3 id="é€‚ç”¨æ€§-17">é€‚ç”¨æ€§</h3>

<ul>
  <li>ä¸€ä¸ªç³»ç»Ÿè¦ç‹¬ç«‹äºå®ƒçš„äº§å“çš„åˆ›å»ºã€ç»„åˆå’Œè¡¨ç¤ºæ—¶ã€‚</li>
  <li>ä¸€ä¸ªç³»ç»Ÿè¦ç”±å¤šä¸ªäº§å“ç³»åˆ—ä¸­çš„ä¸€ä¸ªæ¥é…ç½®æ—¶ã€‚</li>
  <li>éœ€è¦å¼ºè°ƒä¸€ç³»åˆ—ç›¸å…³çš„äº§å“å¯¹è±¡çš„è®¾è®¡ä»¥ä¾¿è¿›è¡Œè”åˆä½¿ç”¨æ—¶ã€‚</li>
  <li>æä¾›ä¸€ä¸ªäº§å“ç±»åº“ï¼Œè€Œåªæƒ³æ˜¾ç¤ºå®ƒä»¬çš„æ¥å£è€Œä¸æ˜¯å®ç°æ—¶ã€‚</li>
</ul>

<h3 id="ç±»å›¾-17">ç±»å›¾</h3>
<p><img src="http://imgs.yansu.org/tech-abstract-pattern-uml.png" alt="abstract pattern" /></p>

<h3 id="å®ä¾‹-19">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">Button</span><span class="p">{}</span>
<span class="kd">class</span> <span class="nc">Border</span><span class="p">{}</span>
<span class="kd">class</span> <span class="nc">MacButton</span> <span class="k">extends</span> <span class="nx">Button</span><span class="p">{}</span>
<span class="kd">class</span> <span class="nc">WinButton</span> <span class="k">extends</span> <span class="nx">Button</span><span class="p">{}</span>
<span class="kd">class</span> <span class="nc">MacBorder</span> <span class="k">extends</span> <span class="nx">Border</span><span class="p">{}</span>
<span class="kd">class</span> <span class="nc">WinBorder</span> <span class="k">extends</span> <span class="nx">Border</span><span class="p">{}</span>

<span class="kd">interface</span> <span class="nc">AbstractFactory</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">CreateButton</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">CreateBorder</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">MacFactory</span> <span class="k">implements</span> <span class="nx">AbstractFactory</span><span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">CreateButton</span><span class="p">(){</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">MacButton</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">CreateBorder</span><span class="p">(){</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">MacBorder</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>
<span class="kd">class</span> <span class="nc">WinFactory</span> <span class="k">implements</span> <span class="nx">AbstractFactory</span><span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">CreateButton</span><span class="p">(){</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">WinButton</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">CreateBorder</span><span class="p">(){</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">WinBorder</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>åœ¨è¿™é‡Œä¾‹å­ä¸­ï¼Œå·¥å‚ç±»å®ç°äº†ä¸€ç»„å·¥å‚æ–¹æ³•ã€‚å¦‚æœè¦å¢åŠ æ–°çš„åŠŸèƒ½ï¼Œå¯ä»¥å¢åŠ æ–°çš„æ¥å£ï¼Œè®©æ–°çš„å·¥å‚ç±»å®ç°è¿™ä¸ªæ¥å£å³å¯ï¼Œè€Œæ— éœ€ä¿®æ”¹ç°æœ‰çš„å·¥å‚ç±»ã€‚</p>

<h3 id="ä¼˜ç¼ºç‚¹-13">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-14">ä¼˜ç‚¹</h4>
<ul>
  <li>åˆ†ç¦»äº†å…·ä½“çš„ç±»</li>
  <li>ä½¿å¢åŠ æˆ–æ›¿æ¢äº§å“æ—å˜å¾—å®¹æ˜“</li>
  <li>æœ‰åˆ©äºäº§å“çš„ä¸€è‡´æ€§</li>
</ul>

<h4 id="ç¼ºç‚¹-11">ç¼ºç‚¹</h4>
<p>éš¾ä»¥æ”¯æŒæ–°ç§ç±»çš„äº§å“ã€‚è¿™æ˜¯å› ä¸ºAbstractFactoryæ¥å£ç¡®å®šäº†å¯ä»¥è¢«åˆ›å»ºçš„äº§å“é›†åˆã€‚æ”¯æŒæ–°å„ç±»çš„äº§å“å°±éœ€è¦æ‰©å±•è®¿å·¥å‚æ¥å£ï¼Œä»è€Œå¯¼è‡´AbstractFactoryç±»åŠå…¶æ‰€æœ‰å­ç±»çš„æ”¹å˜ã€‚</p>

<h3 id="å‚è€ƒ-20">å‚è€ƒ</h3>
<ol>
  <li><a href="http://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F">Wikipedia: æŠ½è±¡å·¥å‚</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">Wikipedia: Abstract factory pattern</a></li>
  <li><a href="http://www.phppan.com/2010/05/php-design-pattern-3-abstract-factory/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°æŠ½è±¡å·¥å‚æ¨¡å¼</a></li>
</ol>

<h2 id="å·¥å‚æ–¹æ³•æ¨¡å¼factory-method-pattern">å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory method patternï¼‰</h2>
<p>å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ä½¿ç”¨â€œå·¥å‚â€æ¦‚å¿µæ¥å®Œæˆå¯¹è±¡çš„åˆ›å»ºè€Œä¸ç”¨å…·ä½“è¯´æ˜è¿™ä¸ªå¯¹è±¡ã€‚</p>

<p>åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­ï¼Œå·¥å‚é€šå¸¸æ˜¯ä¸€ä¸ªç”¨æ¥åˆ›å»ºå…¶ä»–å¯¹è±¡çš„å¯¹è±¡ã€‚å·¥å‚æ˜¯æ„é€ æ–¹æ³•çš„æŠ½è±¡ï¼Œç”¨æ¥å®ç°ä¸åŒçš„åˆ†é…æ–¹æ¡ˆã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-13">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡äº§å“(Product)è§’è‰²ï¼šå…·ä½“äº§å“å¯¹è±¡å…±æœ‰çš„çˆ¶ç±»æˆ–è€…æ¥å£ã€‚</li>
  <li>å…·ä½“äº§å“(Concrete Product)è§’è‰²ï¼šå®ç°æŠ½è±¡äº§å“è§’è‰²æ‰€å®šä¹‰çš„æ¥å£</li>
  <li>æŠ½è±¡å·¥å‚(Creator)è§’è‰²ï¼šå®ƒå£°æ˜äº†å·¥å‚æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›Productå¯¹è±¡</li>
  <li>å…·ä½“å·¥å‚(Concrete Creator)ï¼šå®ç°æŠ½è±¡å·¥å‚æ¥å£</li>
</ul>

<p>å·¥å‚æ–¹æ³•æ¨¡å¼å°±åƒæˆ‘ä»¬å»éº¦å½“åŠ³ä¹°æ±‰å ¡ï¼Œæˆ‘ä»¬åªè¦æ‰¾åˆ°æœåŠ¡å‘˜ï¼Œè®©ä»–å¸®æˆ‘ä»¬æ‹¿æ¥æ±‰å ¡å³å¯ã€‚å…¶ä¸­å…·ä½“æŸä¸ªæœåŠ¡å‘˜å°±åƒå…·ä½“å·¥å‚ï¼Œä»–ç»§æ‰¿äº†æœåŠ¡å‘˜åº”æœ‰çš„æœåŠ¡ã€‚æ±‰å ¡åœ¨åˆ°æ‰‹ä»¥å‰å±äºæŠ½è±¡äº§å“ï¼Œè€Œæˆ‘ä»¬æ‹¿åˆ°çš„æ±‰å ¡å°±å±äºå…·ä½“äº§å“ã€‚</p>

<h3 id="é€‚ç”¨æ€§-18">é€‚ç”¨æ€§</h3>

<ul>
  <li>åˆ›å»ºå¯¹è±¡éœ€è¦å¤§é‡é‡å¤çš„ä»£ç ï¼ˆä¾‹å¦‚åˆ›å»ºä¸€ä¸ªMySQLæ“ä½œç±»ï¼Œéœ€è¦é…ç½®å¾ˆå¤šé€‰é¡¹ï¼Œè¿™äº›éƒ½å¯ä»¥åœ¨å·¥å‚æ–¹æ³•ä¸­è¿›è¡Œï¼‰ã€‚</li>
  <li>åˆ›å»ºå¯¹è±¡éœ€è¦è®¿é—®æŸäº›ä¿¡æ¯ï¼Œè€Œè¿™äº›ä¿¡æ¯ä¸åº”è¯¥åŒ…å«åœ¨å¤åˆç±»ä¸­ã€‚</li>
  <li>åˆ›å»ºå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»é›†ä¸­ç®¡ç†ï¼Œä»¥ä¿è¯åœ¨æ•´ä¸ªç¨‹åºä¸­å…·æœ‰ä¸€è‡´çš„è¡Œä¸ºã€‚</li>
</ul>

<h3 id="ç±»å›¾-18">ç±»å›¾</h3>
<p><img src="http://imgs.yansu.org/tech-factory-method-uml.png" alt="factory method" /></p>

<h3 id="å®ä¾‹-20">å®ä¾‹</h3>

<h4 id="æ™®é€šå·¥å‚æ–¹æ³•">æ™®é€šå·¥å‚æ–¹æ³•</h4>
<p>ä¸‹é¢çš„ä¾‹å­æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„åº”ç”¨ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸¤ç§é£æ ¼çš„æŒ‰é’®ï¼Œåªéœ€ç”¨ä¸åŒçš„å·¥å‚æ–¹æ³•è·å¾—ç›¸åº”æŒ‰é’®ç±»å³å¯ã€‚</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kd">class</span> <span class="nc">Button</span><span class="p">{</span><span class="cm">/* ...*/</span><span class="p">}</span>
<span class="kd">class</span> <span class="nc">WinButton</span> <span class="k">extends</span> <span class="nx">Button</span><span class="p">{</span><span class="cm">/* ...*/</span><span class="p">}</span>
<span class="kd">class</span> <span class="nc">MacButton</span> <span class="k">extends</span> <span class="nx">Button</span><span class="p">{</span><span class="cm">/* ...*/</span><span class="p">}</span>

<span class="kd">interface</span> <span class="nc">ButtonFactory</span><span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createButton</span><span class="p">(</span><span class="nv">$type</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">MyButtonFactory</span> <span class="k">implements</span> <span class="nx">ButtonFactory</span><span class="p">{</span>
    <span class="c1">// å®ç°å·¥å‚æ–¹æ³•</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">createButton</span><span class="p">(</span><span class="nv">$type</span><span class="p">){</span>
        <span class="k">switch</span><span class="p">(</span><span class="nv">$type</span><span class="p">){</span>
            <span class="k">case</span> <span class="s1">'Mac'</span><span class="o">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nx">MacButton</span><span class="p">();</span>
            <span class="k">case</span> <span class="s1">'Win'</span><span class="o">:</span>
                <span class="k">return</span> <span class="k">new</span> <span class="nx">WinButton</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>ä¸Šä¾‹ä¸­çš„<code class="highlighter-rouge">createButton()</code>æ–¹æ³•å³æ‰€è°“çš„å·¥å‚æ–¹æ³•ï¼Œå®ƒæ‰€åœ¨çš„ç±»ä»…ä»…æ˜¯è¿™ä¸ªæ–¹æ³•çš„è½½ä½“ã€‚å·¥å‚æ–¹æ³•çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯åˆ›å»ºç±»å¹¶è¿”å›ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥äº§ç”Ÿä¸€ä¸ªç±»ï¼Œä¹Ÿå¯ä»¥äº§ç”Ÿå¤šç§ç±»ã€‚è¿™ä¸ªæ–¹æ³•æœ¬èº«çš„è½½ä½“ä¹Ÿå¹¶ä¸å±€é™ï¼Œå°†å…¶è®¾ç½®ä¸ºé™æ€æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™ä¸ªæ ¹æ®è‡ªå·±çš„æƒ…å†µè€Œå®šã€‚</p>

<h3 id="ä¼˜ç¼ºç‚¹-14">ä¼˜ç¼ºç‚¹</h3>

<h4 id="ä¼˜ç‚¹-15">ä¼˜ç‚¹</h4>
<p>å·¥å‚æ–¹æ³•æ¨¡å¼å¯ä»¥å…è®¸ç³»ç»Ÿåœ¨ä¸ä¿®æ”¹å·¥å‚è§’è‰²çš„æƒ…å†µä¸‹å¼•è¿›æ–°äº§å“ã€‚</p>

<h4 id="ç¼ºç‚¹-12">ç¼ºç‚¹</h4>
<ul>
  <li>é‡æ„å·²ç»å­˜åœ¨çš„ç±»ä¼šç ´åå®¢æˆ·ç«¯ä»£ç ã€‚</li>
  <li>å¦‚æœå·¥å‚æ–¹æ³•æ‰€åœ¨ç±»çš„æ„é€ å‡½æ•°ä¸ºç§æœ‰ï¼Œåˆ™å·¥å‚æ–¹æ³•æ— æ³•ç»§ç»­æ‰©å±•ï¼Œæˆ–è€…å¿…é¡»å®ç°å·¥å‚æ–¹æ³•æ‰€åœ¨ç±»çš„å…¨éƒ¨ä¾èµ–æ–¹æ³•ã€‚</li>
</ul>

<h3 id="å‚è€ƒ-21">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Factory_method_pattern">Wikipedia: Factory method pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F">Wikipedia: å·¥å‚æ–¹æ³•æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/07/php-design-pattern-9-factory-method/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°å·¥å‚æ¨¡å¼</a></li>
</ol>

<h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼template-method-pattern">æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate method patternï¼‰</h2>
<p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒå®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚Template Method ä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„çš„æƒ…å†µä¸‹é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šçš„æ­¥éª¤ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-14">ä¸»è¦è§’è‰²</h3>

<h4 id="æŠ½è±¡æ¨¡æ¿abstractclassè§’è‰²">æŠ½è±¡æ¨¡æ¿(AbstractClass)è§’è‰²</h4>
<p>å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªæŠ½è±¡æ–¹æ³•è®©å­ç±»å®ç°ã€‚è¿™äº›æŠ½è±¡æ–¹æ³•å«åšåŸºæœ¬æ“ä½œï¼Œå®ƒä»¬æ˜¯é¡¶çº§é€»è¾‘çš„ç»„æˆéƒ¨åˆ†ã€‚</p>

<p>å®šä¹‰ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ã€‚è¿™ä¸ªæ¨¡æ¿æ–¹æ³•ä¸€èˆ¬æ˜¯ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œå®ƒç»™å‡ºé¡¶çº§é€»è¾‘çš„éª¨æ¶ï¼Œè€Œé€»è¾‘çš„ç»„æˆæ­¥éª¤åœ¨å¯¹åº”çš„æŠ½è±¡æ“ä½œä¸­ï¼Œè¿™äº›æ“ä½œå°†ä¼šæ¨è¿Ÿåˆ°å­ç±»ä¸­å®ç°ã€‚åŒæ—¶ï¼Œé¡¶å±‚é€»è¾‘ä¹Ÿå¯ä»¥è°ƒç”¨å…·ä½“çš„å®ç°æ–¹æ³•</p>

<h5 id="å…·ä½“æ¨¡æ¿concrteclassè§’è‰²">å…·ä½“æ¨¡æ¿(ConcrteClass)è§’è‰²</h5>
<p>å®ç°çˆ¶ç±»çš„ä¸€ä¸ªæˆ–å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä½œä¸ºé¡¶å±‚é€»è¾‘çš„ç»„æˆè€Œå­˜åœ¨ã€‚</p>

<p>æ¯ä¸ªæŠ½è±¡æ¨¡æ¿å¯ä»¥æœ‰å¤šä¸ªå…·ä½“æ¨¡æ¿ä¸ä¹‹å¯¹åº”ï¼Œè€Œæ¯ä¸ªå…·ä½“æ¨¡æ¿æœ‰å…¶è‡ªå·±å¯¹æŠ½è±¡æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯é¡¶å±‚é€»è¾‘çš„ç»„æˆéƒ¨åˆ†ï¼‰çš„å®ç°ï¼Œä»è€Œä½¿å¾—é¡¶å±‚é€»è¾‘çš„å®ç°å„ä¸ç›¸åŒã€‚</p>

<h3 id="é€‚ç”¨æ€§-19">é€‚ç”¨æ€§</h3>

<ul>
  <li>ä¸€æ¬¡æ€§å®ç°ä¸€ä¸ªç®—æ³•çš„ä¸å˜çš„éƒ¨åˆ†ï¼Œå¹¶å°†å¯å˜çš„è¡Œä¸ºç•™ç»™å­ç±»æ¥å®ç°ã€‚</li>
  <li>å„å­ç±»ä¸­å…¬å…±çš„è¡Œä¸ºåº”è¢«æå–å‡ºæ¥å¹¶é›†ä¸­åˆ°ä¸€ä¸ªå…¬å…±çˆ¶ç±»ä¸­ä»¥é¿å…ä»£ç é‡å¤ã€‚</li>
  <li>æ§åˆ¶å­ç±»æ‰©å±•ã€‚</li>
</ul>

<h3 id="ç±»å›¾-19">ç±»å›¾</h3>

<p><img src="http://imgs.yansu.org/tech-template-method-pattern-uml.jpg" alt="template method pattern" /></p>

<h3 id="å®ä¾‹-21">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">AbstractClass</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡æ¨¡æ¿è§’è‰²</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">templateMethod</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// æ¨¡æ¿æ–¹æ³• è°ƒç”¨åŸºæœ¬æ–¹æ³•ç»„è£…é¡¶å±‚é€»è¾‘</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">primitiveOperation1</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">primitiveOperation2</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">abstract</span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">primitiveOperation1</span><span class="p">();</span> <span class="c1">// åŸºæœ¬æ–¹æ³•</span>
    <span class="k">abstract</span> <span class="k">protected</span> <span class="k">function</span> <span class="nf">primitiveOperation2</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ConcreteClass</span> <span class="k">extends</span> <span class="nx">AbstractClass</span> <span class="p">{</span> <span class="c1">// å…·ä½“æ¨¡æ¿è§’è‰²</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">primitiveOperation1</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">primitiveOperation2</span><span class="p">(){}</span>

<span class="p">}</span>

<span class="nv">$class</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConcreteClass</span><span class="p">();</span>
<span class="nv">$class</span><span class="o">-&gt;</span><span class="na">templateMethod</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="å‚è€ƒ-22">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Template_method_pattern">Wikipedia: Template method pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F">Wikipedia: æ¨¡æ¿æ–¹æ³•æ¨¡å¼</a></li>
  <li><a href="http://www.phppan.com/2010/09/php-design-pattern-16-template-method/">PHPè®¾è®¡æ¨¡å¼ç¬”è®°ï¼šä½¿ç”¨PHPå®ç°æ¨¡æ¿æ–¹æ³•æ¨¡å¼</a></li>
</ol>

<h2 id="è´£ä»»é“¾æ¨¡å¼chain-of-responsibility-pattern">è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of responsibility patternï¼‰</h2>
<p>è´£ä»»é“¾æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ï¼Œå®ƒåŒ…å«äº†ä¸€äº›å‘½ä»¤å¯¹è±¡å’Œä¸€ç³»åˆ—çš„å¤„ç†å¯¹è±¡ã€‚æ¯ä¸€ä¸ªå¤„ç†å¯¹è±¡å†³å®šå®ƒèƒ½å¤„ç†å“ªäº›å‘½ä»¤å¯¹è±¡ï¼Œå®ƒä¹ŸçŸ¥é“å¦‚ä½•å°†å®ƒä¸èƒ½å¤„ç†çš„å‘½ä»¤å¯¹è±¡ä¼ é€’ç»™è¯¥é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¤„ç†å¯¹è±¡ã€‚è¯¥æ¨¡å¼è¿˜æè¿°äº†å¾€è¯¥å¤„ç†é“¾çš„æœ«å°¾æ·»åŠ æ–°çš„å¤„ç†å¯¹è±¡çš„æ–¹æ³•ã€‚</p>

<h3 id="ä¸»è¦è§’è‰²-15">ä¸»è¦è§’è‰²</h3>

<ul>
  <li>æŠ½è±¡è´£ä»»(Responsibilityï¼‰è§’è‰²ï¼šå®šä¹‰æ‰€æœ‰è´£ä»»æ”¯æŒçš„å…¬å…±æ–¹æ³•ã€‚</li>
  <li>å…·ä½“è´£ä»»(Concrete Responsibility)è§’è‰²ï¼šä»¥æŠ½è±¡è´£ä»»æ¥å£å®ç°çš„å…·ä½“è´£ä»»</li>
  <li>è´£ä»»é“¾(Chain of responsibility)è§’è‰²ï¼šè®¾å®šè´£ä»»çš„è°ƒç”¨è§„åˆ™</li>
</ul>

<h3 id="å®ä¾‹-22">å®ä¾‹</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Responsibility</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡è´£ä»»è§’è‰²</span>
    <span class="k">protected</span> <span class="nv">$next</span><span class="p">;</span> <span class="c1">// ä¸‹ä¸€ä¸ªè´£ä»»è§’è‰²</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setNext</span><span class="p">(</span><span class="nx">Responsibility</span> <span class="nv">$l</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">next</span> <span class="o">=</span> <span class="nv">$l</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">operate</span><span class="p">();</span> <span class="c1">// æ“ä½œæ–¹æ³•</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ResponsibilityA</span> <span class="k">extends</span> <span class="nx">Responsibility</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operate</span><span class="p">(){</span>
        <span class="k">if</span> <span class="p">(</span><span class="kc">false</span> <span class="o">==</span> <span class="nb">is_null</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">next</span><span class="o">-&gt;</span><span class="na">operate</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ResponsibilityB</span> <span class="k">extends</span> <span class="nx">Responsibility</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">operate</span><span class="p">(){</span>
        <span class="k">if</span> <span class="p">(</span><span class="kc">false</span> <span class="o">==</span> <span class="nb">is_null</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">next</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">next</span><span class="o">-&gt;</span><span class="na">operate</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="nv">$res_a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ResponsibilityA</span><span class="p">();</span>
<span class="nv">$res_b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ResponsibilityB</span><span class="p">();</span>
<span class="nv">$res_a</span><span class="o">-&gt;</span><span class="na">setNext</span><span class="p">(</span><span class="nv">$res_b</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<h3 id="å‚è€ƒ-23">å‚è€ƒ</h3>
<ol>
  <li><a href="http://en.wikipedia.org/wiki/Chain_of_responsibility_pattern">Wikipedia: Chain-of-responsibility pattern</a></li>
  <li><a href="http://zh.wikipedia.org/wiki/%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F">Wikipedia: è´£ä»»é“¾æ¨¡å¼</a></li>
</ol>
:ET