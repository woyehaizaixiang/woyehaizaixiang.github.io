I"ê	<blockquote>
  <p>åˆ©ç”¨Rediså¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œä½†æ˜¯åœ¨Laravelä¸­ï¼ŒRedisçš„é˜Ÿåˆ—æ€»ä¼šå‡ºç°ä¸€ä¸ªä»»åŠ¡å¤šæ¬¡æ‰§è¡Œçš„é—®é¢˜ã€‚ç©¶å…¶åŸå› æ˜¯å®ƒå†™æ­»äº†reservedçš„æ—¶é•¿ï¼Œä¹Ÿå°±æ˜¯å¦‚æœ1åˆ†é’Ÿåä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡å°±ä¼šè¢«é‡æ–°æ”¾å›é˜Ÿåˆ—ã€‚ä¸‹é¢æ˜¯é˜Ÿåˆ—çš„ç®€å•ä½¿ç”¨å’Œæ‰§è¡ŒåŸç†ã€‚</p>
</blockquote>

<h2 id="è®¾ç½®">è®¾ç½®</h2>
<p>è®¾ç½®é˜Ÿåˆ—ä½¿ç”¨Rediséå¸¸å®¹æ˜“ï¼Œåœ¨<code class="highlighter-rouge">app/config/queue.php</code>ä¸­é…ç½®</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
'default' =&gt; 'redis',
...
'connections' =&gt; array(
    ...
    'redis' =&gt; array(
        'driver' =&gt; 'redis',
        'queue'  =&gt; 'waa',
    ),
),
</code></pre></div></div>

<p>å³å¯ã€‚</p>

<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>
<p>ä½¿ç”¨æ—¶ä¸éœ€è¦å¤šé…ç½®ï¼Œåªè¦å†™å¥½Queueç±»å’Œå…¶fireæ–¹æ³•ï¼Œåœ¨éœ€è¦çš„ä½ç½®å‡ºé˜Ÿå³å¯ã€‚å…·ä½“æ–¹æ³•å¯ä»¥çœ‹<a href="http://laravel.com/docs/queues#basic-usage">è¿™é‡Œ</a>ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class SendEmail {

    public function fire($job, $data)
    {
        //
        $job-&gt;delete();
    }

}

Queue::push('SendEmail@send', array('message' =&gt; $message));
</code></pre></div></div>

<h2 id="æµç¨‹">æµç¨‹</h2>
<p>Laravelåˆ©ç”¨artisanå‘½ä»¤æ¥æ‰§è¡Œå‡ºé˜Ÿæ“ä½œï¼Œç„¶åè¿›è¡Œä»»åŠ¡çš„æ‰§è¡Œã€‚æ–¹æ³•è°ƒç”¨å¦‚ä¸‹ï¼š</p>

<ol>
  <li>artisan queue:work</li>
  <li>WorkerCommand:fire()</li>
  <li>Worker:pop()</li>
  <li>Worker:getNextJob()</li>
  <li>RedisQueue:pop()</li>
  <li>Worker:process()</li>
</ol>

<p>æˆ‘é‡åˆ°çš„é—®é¢˜å°±åœ¨è¿™é‡Œï¼Œåœ¨<code class="highlighter-rouge">RedisQueue:pop()</code>æ–¹æ³•ä¸­ï¼Œæœ‰è¿™æ ·ä¸€å¥ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$this-&gt;redis-&gt;zadd($queue.':reserved', $this-&gt;getTime() + 60, $job);
</code></pre></div></div>

<p>è¿™é‡Œå°†å½“å‰æ‰§è¡Œçš„ä»»åŠ¡æ”¾åˆ°å¦å¤–ä¸€ä¸ªreservedé˜Ÿåˆ—ä¸­ï¼Œè¶…æ—¶æ—¶é—´æ˜¯60sã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ60såè¿™ä¸ªä»»åŠ¡æ²¡æœ‰è¢«åˆ é™¤æ‰ï¼Œåˆ™ä»»åŠ¡ä¼šé‡æ–°è¢«æ”¾å…¥é˜Ÿåˆ—ä¸­æ¥ã€‚å› æ­¤ï¼Œåœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä»»åŠ¡å¾ˆå¯èƒ½è¢«å¤šæ¬¡æ‰§è¡Œã€‚è§£å†³çš„åŠæ³•æ˜¯</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class SendEmail {

    public function fire($job, $data)
    {
        $job-&gt;delete();
        // job 
    }

}
</code></pre></div></div>

<p>å³å…ˆåˆ é™¤è¿™ä¸ªä»»åŠ¡ï¼Œå†å¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚</p>
:ET