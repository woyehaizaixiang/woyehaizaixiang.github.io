I"µ<h1>kanyunçš„éƒ¨ç½²</h1>

<ul>
  <li><a href="#all">1 å…¨éƒ¨èŠ‚ç‚¹é…ç½®</a>
    <ul>
      <li><a href="#all-zmq">1.1 å®‰è£…zmq</a></li>
      <li><a href="#all-kanyun">1.2 å®‰è£…kanyun</a></li>
    </ul>
  </li>
  <li><a href="#controller">2 æ§åˆ¶èŠ‚ç‚¹é…ç½®</a>
    <ul>
      <li><a href="#controller-cassandra">2.1 å®‰è£…é…ç½®cassandra</a></li>
      <li><a href="#controller-kanyun">2.2 å¯åŠ¨å’Œé…ç½®kanyun</a></li>
    </ul>
  </li>
  <li><a href="#compute">3 è®¡ç®—èŠ‚ç‚¹é…ç½®</a>
    <ul>
      <li><a href="#compute-kanyun">3.1 å¯åŠ¨å’Œé…ç½®kanyun</a></li>
    </ul>
  </li>
</ul>

<h2 id="all">1 å…¨éƒ¨èŠ‚ç‚¹</h2>
<h3 id="all-zmq">1.1 å®‰è£…zmq</h3>
<h4>å®‰è£…zerozmq(2.2.0)</h4>
<ol>
  <li>yum install libtool autoconf automake</li>
  <li>yum install uuid-devel</li>
  <li>yum install libuuid-devel</li>
  <li>wget http://download.zeromq.org/zeromq-2.2.0.tar.gz</li>
  <li>tar zxvf zeromq-2.2.0.tar.gz &amp; cd zeromq-2.2.0 &amp; ./configure &amp; make install</li>
  <li>ldconfig</li>
</ol>

<h4>å®‰è£…pyzmq</h4>
<ol>
  <li>easy_install â€œpyzmq==2.2.0â€</li>
  <li>å¦‚æœå‡ºç°ç¼ºå°‘libzmq.so.1çš„æƒ…å†µï¼Œå¯èƒ½æ˜¯é“¾æ¥åº“æ²¡æœ‰æ­£ç¡®é…ç½®ã€‚</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>sudo /sbin/ldconfig -v</td>
          <td>grep libzmqæŸ¥çœ‹æ˜¯å¦æœ‰æ‰€éœ€é“¾æ¥</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>å¦‚æœæ²¡æœ‰libzmq.so.1 -&gt; libzmq.so.1.0.1ï¼Œåˆ™ä¿®æ”¹/etc/ld.so.confï¼Œåœ¨æœ«å°¾å¢åŠ /usr/local/libï¼Œç„¶åldconfig -v</td>
          <td>grep libzmqå³å¯</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>å¦‚æœå‡ºç°ç¼ºå°‘Python.hï¼Œåˆ™ä½¿ç”¨yum install python-develæ¥å®‰è£…</li>
</ol>

<h3 id="all-kanyun">1.2 å®‰è£…kanyun</h3>
<h4>ä¸‹è½½ä»£ç </h4>
<p>kanyunåŸæ¥çš„ä»£ç æœ‰bugï¼Œè€Œä¸”ä¸èƒ½åœ¨python2.6ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œä¸‹é¢æ˜¯æˆ‘æ”¹è¿‡çš„</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /opt
git clone https://github.com/suyan/kanyun.git
</code></pre></div></div>

<p>ä¿®æ”¹å†…å®¹ï¼š</p>

<ul>
  <li>å…¼å®¹python2.6å’Œ2.7ï¼ˆpython2.6éœ€è¦å®‰è£…OrderedDictï¼‰</li>
  <li>ä¿®æ”¹è·å–å†…å­˜ä¿¡æ¯æ–¹å¼å’Œè®¡ç®—cpuä½¿ç”¨ç‡æ–¹å¼</li>
  <li>ä¿®å¤ä¸€äº›bug</li>
</ul>

<h4>å®‰è£…</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python /opt/kanyun/setup.py install
</code></pre></div></div>
<h4>åˆ›å»ºæ—¥å¿—ç›®å½•</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /var/log/kanyun
</code></pre></div></div>
<h4>å®‰è£…OrderedDict(python2.6)</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>easy_install OrderedDict
</code></pre></div></div>

<h2 id="controller">2 æ§åˆ¶èŠ‚ç‚¹</h2>
<h3 id="controller-cassandra">2.1 å®‰è£…é…ç½®cassandra</h3>
<h4>ä¸‹è½½Cassandra</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /opt
wget http://mirror.bit.edu.cn/apache/cassandra/0.8.10/apache-cassandra-0.8.10-bin.tar.gz
</code></pre></div></div>
<h4>è§£å‹</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar zxvf apache-cassandra-0.8.10-bin.tar.gz
</code></pre></div></div>
<h4>è¿è¡Œ</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/opt/apache-cassandra-0.8.10/bin/cassandra
</code></pre></div></div>
<h4>åˆ›å»ºæ•°æ®åº“</h4>
<p>é€šè¿‡å‘½ä»¤æ‰“å¼€æ•°æ®åº“</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/opt/apache-cassandra-0.8.10/bin/cassandra-cli -h 127.0.0.1
</code></pre></div></div>

<p>å¹¶æ‰§è¡Œä¸‹é¢å‘½ä»¤</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE keyspace DATA;
USE DATA;

CREATE COLUMN family vmnetwork WITH column_type='Super' AND comparator='AsciiType' AND subcomparator='IntegerType' AND default_validation_class='AsciiType';
CREATE COLUMN family cpu WITH column_type='Super' AND comparator='AsciiType' AND subcomparator='IntegerType' AND default_validation_class='AsciiType';
CREATE COLUMN family mem_max WITH column_type='Super' AND comparator='AsciiType' AND subcomparator='IntegerType' AND default_validation_class='AsciiType';
CREATE COLUMN family mem_free WITH column_type='Super' AND comparator='AsciiType' AND subcomparator='IntegerType' AND default_validation_class='AsciiType';
CREATE COLUMN family nic_incoming WITH column_type='Super' AND comparator='AsciiType' AND subcomparator='IntegerType' AND default_validation_class='AsciiType';
CREATE COLUMN family nic_outgoing WITH column_type='Super' AND comparator='AsciiType' AND subcomparator='IntegerType' AND default_validation_class='AsciiType';
CREATE COLUMN family blk_read WITH column_type='Super' AND comparator='AsciiType' AND subcomparator='IntegerType' AND default_validation_class='AsciiType';
CREATE COLUMN family blk_write WITH column_type='Super' AND comparator='AsciiType' AND subcomparator='IntegerType' AND default_validation_class='AsciiType';

assume vmnetwork KEYS AS ascii;
assume cpu KEYS AS ascii;
assume mem_max KEYS AS ascii;
assume nic_incoming KEYS AS ascii;
assume nic_outgoing KEYS AS ascii;
assume blk_read KEYS AS ascii;
assume blk_write KEYS AS ascii;
assume mem_free KEYS AS ascii;       
</code></pre></div></div>

<h4>å®‰è£…pycassaæ”¯æŒ</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>easy_install pycassa
</code></pre></div></div>

<p>å¦‚æœå‡ºç°<em>The required version of distribute is not available</em></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>easy_install -U distribute
</code></pre></div></div>

<h3 id="controller-kanyun">2.2 å¯åŠ¨å’Œé…ç½®kanyun</h3>
<h4>é…ç½®/etc/kanyun.conf</h4>
<ul>
  <li>æ–‡ä»¶ä¸­hostéœ€è¦å¡«å†™è®¡ç®—èŠ‚ç‚¹çš„ip</li>
  <li>sql_connectionå¡«å†™nova.confä¸­connectionå€¼</li>
</ul>

<p>é…ç½®æ–‡ä»¶</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[kanyun]
log: /var/log/kanyun/kanyun.log
[DEFAULT]
sql_connection: mysql://nova:novamysqlpassword@controller/nova
[server]
host: 172.19.9.1 
port: 5551
db_host: 127.0.0.1
log: /var/log/kanyun/kanyun-server.log
[api]
api_host: 172.19.9.1
api_port: 5552
db_host: 127.0.0.1
log: /var/log/kanyun/kanyun-api.log
[client]
api_host: 172.19.9.1
api_port: 5552
log: /var/log/kanyun/kanyun-client.log 
</code></pre></div></div>

<h4>å¯åŠ¨æœåŠ¡</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python /opt/kanyun/bin/kanyun-server &amp;
python /opt/kanyun/bin/kanyun-api &amp;
</code></pre></div></div>

<h2 id="compute">3 è®¡ç®—èŠ‚ç‚¹</h2>
<h3 id="compute-kanyun">3.1 å¯åŠ¨å’Œé…ç½®kanyun</h3>
<h4>é…ç½®/etc/kanyun.conf</h4>
<ul>
  <li>æ–‡ä»¶ä¸­api_hostéœ€è¦å¡«å†™è®¡ç®—èŠ‚ç‚¹çš„ip</li>
  <li>sql_connectionå¡«å†™nova.confä¸­connectionå€¼</li>
  <li>idæ ¹æ®èŠ‚ç‚¹ç¼–å·è‡ªå·±è®¾ç½®</li>
</ul>

<p>é…ç½®æ–‡ä»¶</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[kanyun]
log: /var/log/kanyun/kanyun.log
[DEFAULT]
sql_connection: mysql://nova:novamysqlpassword@controller/nova
[worker]
id: worker1
worker_timeout: 60
dataserver_host: 172.19.9.1
dataserver_port: 5551
log: /var/log/kanyun/kanyun-worker.log
[client]
api_host: 172.19.9.1
api_port: 5552
log: /var/log/kanyun/kanyun-client.log
</code></pre></div></div>

<h4>å¯åŠ¨æœåŠ¡</h4>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python /opt/kanyun/bin/kanyun-worker &amp;
</code></pre></div></div>

:ET