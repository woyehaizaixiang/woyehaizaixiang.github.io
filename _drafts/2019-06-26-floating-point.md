---
layout: post
title: 计算机组成 - 浮点数的表示和运算
categories: Computer
description: 本文记述了计算机系统中数据的表示形式
keywords: Computer
mathjax: true
---

浮点数，是属于有理数中某特定子集的数的数字表示，在计算机中用以近似表示任意某个实数。

* TOC
{:toc}

# 表示

## 浮点数的表示

$$N=r^E\times M$$

注: $$r$$ 为阶码的底, 在计算机中为 2; $$E$$ 为阶码, $$M$$ 为尾数

* 机器数表示:  
  
    | 阶码阶符 | 阶码数值部分 | 尾数数符 | 尾数数值部分 |
    | :-: | :-: | :-: | :-: |
    | $$J_r$$ | $$J_1J_2\dots J_m$$ | $$S_r$$ | $$S_1S_2\dots S_n$$ |

* 真值: $$N= 2^E \times M$$,

* 特点: 

    * 阶码 $$E$$ 通常用补码或移码表示, 尾数 $$M$$ 通常用原码和补码表示

    * 阶码 $$E$$ 反映浮点数的表示范围和小数点的位置, 尾数 $$M$$ 反映浮点数的精度

## 浮点数的规范化

* 规则: 尾数 $$M$$ 的最高位必须是一个有效值:  

    * 左归: 将尾数左移一位, 阶码减一
    * 右归: 将尾数右移一位, 阶码加一

    例: $$a=010;00.1001, b=010;00.1000,\ 求\ a+b$$  

    $$
    \begin{align}
    a+b &=2^{010}\times 0.1001 + 2^{010}\times 0.1000\\
    &=2^{010}\times (0.1001 + 0.1000)\\
    &=2^{010}\times 1.0001\\
    &=2^{011}\times 0.0001\\
    \end{align}
    $$

* 特点: 尾数有固定的绝对值范围

    * 原码规格化: 

        * 正数: $$[0.11\dots 111,\ 0.10\dots 000] \to [\frac {1}{2},\ 1-2^{-n}]$$
        * 负数: $$[1.11\dots 111,\ 1.10\dots 000] \to [-(1-2^{-n}),\ -\frac {1}{2}]$$

    * 补码规格化: 

        * 正数: $$[0.11\dots 111,\ 0.10\dots 000] \to [\frac {1}{2},\ 1-2^{-n}]$$
        * 负数: $$[1.00\dots 000,\ 1.01\dots 111] \to [-1,\ -(\frac {1}{2}+2^{-n})]$$

## 浮点数的溢出

![浮点溢出](https://zoharyip.club/images/posts/浮点溢出.png "浮点溢出")

## IEEE 754 标准

数符 | 阶码 | 尾数数值位
:-: | :-: | :-:
$$m_S$$ | $$E$$ | $$M$$

* 数符: 表示浮点数正负
* 阶码: 用移码表示
* 尾数: 用原码表示, 既然规定必须为有效数值, 最高位固定为 1, 隐藏表示最高位 1

$$N=(-1)^S\times 1.M\times2^{E-dv}$$

### 各长度浮点数

类型 | 数符 | 阶码 | 尾数 | 总位数 | 偏置值$$(dv)$$
-: | :-: | :-: | :-: | :-: | :-
短浮点数 | 1 | 8 | 23 | 32 | $$2^{8-1}-1$$
长浮点数 | 1 | 11 | 52 | 64 | $$2^{11-1}-1$$
临时浮点数 | 1 | 15 | 64 | 80 | $$2^{15-1}-1$$


例: $$1;000\ 0001\ 1;100\ 1010\ 0101\ 0000\ 1000\ 0000$$

$$N=(-1)^1\times 1.10010100101000010000000\times 2^{00000011-01111111}$$

### 标准规定

以短浮点数为例: 

1. 若 $$E=0\ \&\ M=0$$, 则真值为 0;  
2. 若 $$E=0\ \&\ M\neq 0$$, 为非规格化数, 真值 $$=(-1)^S\times 0.M\times 2^{-126}$$
3. 若 $$1\le E\le 254$$ 时, 真值 $$=(-1)^S\times 1.M\times 2^{E-127}$$
4. 若 $$E=255\ \&\ M\neq0$$, 真值为 $$NAN$$
5. 若 $$E=255\ \&\ M=0$$, 真值为正无穷或负无穷

### 各长度浮点数范围

格式 | 最小值 | 最大值
:-: | :- | :-
单精度 | $$E=1, M=0\to 1.0\times 2^{1-127}=2^{-126}$$ | $$E=254, M=.11\dots 1\to 1.11\dots 1\times 2^{254-127}=2^{127}\times (2-2^{-23})$$
双精度 | $$E=1, M=0\to 1.0\times 2^{1-1023}=2^{-1022}$$ | $$E=2046, M=.11\dots 1\to 1.11\dots 1\times 2^{2046-1023}=2^{1023}\times (2-2^{-52})$$

# 浮点数运算

## 加减运算

0. 真值转换为机器数
1. 对阶
2. 尾数加减
3. 规格化
4. 舍入
    * "0" 舍 "1" 入法
    * 恒置 "1" 法
5. 判断溢出

例: $$X=-\frac {5}{256},Y=\frac {59}{1024}, 计算 X-Y$$, 浮点数格式为:阶符 2 位, 阶码 3 位, 数符 2 位, 尾数 9 位

0. 转换格式:  
$$5D=101B\to X=-101\times 2^{-8} = -0.101\times 2^{-5} = -0.101\times 2^{-101}$$  
$$59D=111011B\to Y=111011\times 2^{-10} = 0.111011\times 2^{-4}= 0.111011\times 2^{-100}$$  
$$X: 11,011;11,011000000\\Y:11,100;00,111011000$$

1. 对阶: 小阶向大阶对齐, 尾数右移一位, 阶码加 1  
    1. 求阶差: $$[\Delta E]_补=11,011+00,100=11,111=(-1)_{10}$$
    2. 对阶: $$X: 11,011;11,011000000\to 11,100;11,101100000 = 0.0101\times 2^{-100}$$

2. 尾数加减:  
$$[X]_补-[Y]_补=[X]_补+[-Y]_补\\ [-Y]_补=11,100;11,000101000 $$  
$$X-Y=11,100; (11,101100000 + 11,000101000)=11,100; 10,110001000$$  
发生溢出

3. 规格化:  
$$X-Y: 11,100; 10,110001000 \to 11,101;11,011000100$$

4. 舍入:  
最后一位为 0 直接舍去

5. 判断溢出: 阶符和数符皆无异常, 故无溢出

# 强制类型转换

$$
\begin{array}{l|ccc}
type&\text{x16}&\text{x32}&\text{x64}\\
\hline
char&8&8&8\\
short&16&16&16\\
int&16&32&32\\
long&32&32&64\\
long long&64&64&64\\
float&16&32&32\\
double&64&64&64\\
\end{array}
$$

## 无损转换

范围、精度从小到大，转换过程没有损失

1. $$char\to int\to long\to double$$
2. $$float\to double$$

int 不能与 float 互转：  

int： $$-2^{31} \sim 2^{31}-1$$, 有效数字 32 位  
float： $$\pm [2^{-126}\sim 2^{127}\times (2-2^{-23})]$$, 有效数字23+1=24位

1. $$int\to float$$: 可能损失精度
2. $$float\to int$$: 可能溢出及损失精度