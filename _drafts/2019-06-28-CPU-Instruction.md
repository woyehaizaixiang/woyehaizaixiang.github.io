---
layout: post
title: 计算机组成 - CPU 指令系统
categories: Computer
description: 本文记述了计算机系统中CPU的主要信息
keywords: Computer
mathjax: true
---

指令系统是计算机硬件的语言系统，也叫机器语言，指机器所具有的全部指令的集合，它是软件和硬件的分界面，反映了计算机所拥有的基本功能。

* TOC
{:toc}

概念 | 释义
:-: | :-
指令 | 计算机执行某类操作的信息的集合
指令集 | 处理器能执行的全体指令的集合
指令字 | 用来表示指令的一组二进制代码
指令字长 | 指令中包含的二进制代码位数
机器字长 | 计算机能够直接处理的二进制数据的位数（CPU 位数）

# 指令集类型

## CISC(Complex Instruction Set Computing)

复杂指令集计算

* 原因：

    早期计算机部件昂贵、速度慢，为了扩展硬件功能，不得不将更多更复杂指令加入到指令系统，以提高计算机的处理能力

* 特点：

    1. 指令数量多

    2. 指令长度可以不固定，指令格式和寻址方式多样

    3. 很多指令会涉及存储器读写操作，指令周期长

    4. 一般在通用处理器中使用

## RISC(Reduced Instruction Set Computing)

精简指令集

* 原因：

    随着半导体技术进步，80年代开始逐渐直接通过硬件方式，而不是扩充指令来实现复杂功能，指令规模逐渐缩小、指令进一步简化

* 特点：

    1. 指令数量少

    2. 指令长度固定，指令格式和寻址方式种类也少

    3. 一般只有少量指令(如取数/存数) 才会读写存储器，其余指令只涉及 CPU 内部寄存器，指令周期短；

    4. 一般在高端服务器 CPU 中使用

## 技术背景

1. 2 - 8 规律

    简单指令(约占20%的)约占80%的使用频率，复杂指令(约占80%)只占大约20%的使用频率。

2. 不利于 VLSI 工艺

    为实现大量的复杂指令，控制逻辑极不规整，给 VLSI 工艺造成很大困难。

3. 主存技术的发展

    一般通过保存在控制存储器中的微程序来实现复杂指令，70 年代后期开始用 DRAM 做主存，使主存与控制存储器的速度相当，因此很多复杂指令不必再用微程序来实现，**可用简单指令构成的子程序实现等效功能**。

# 指令格式

| 操作码 | 地址码A/操作数D |
| :-: | :-: |
| 1 个 | 1 个或几个 |

## 指令字长

* 定长指令格式：规整、便于管理

* 边长指令格式：合理利用存储空间、提高取指令的效率

## 操作码结构

1. 定长操作码

    各指令的位置、位数固定不变

2. 拓展操作码

    各指令的位置、位数不固定，根据需要变化，需设置拓展标志

3. 复合型操作码

    操作码分为几段，每段表示一种二级操作

## 地址结构

$$
指令中提供的地址
\begin{cases}
\ \ 地址偏移量/立即数\\[5ex]
\ \ 寄存器编号
\end{cases}
$$

1. 指令中提供地址的方式

    1. 显式地址方式

        指令中明确指明地址码

    2. 隐式地址方式

        地址码隐含约定，不在指令中出现，可以减少指令中的地址数量，从而简化地址结构

2. 常见的地址结构类型

    * 四地址结构指令

        | $$\theta$$ | A1 | A2 | A3 | A4 |
        | :-: | :-: | :-: | :-: | :-:|
        | 操作码 | 操作数地址1 | 操作数地址2 | 结果地址 | 下一指令地址 |

        功能：

        $$(A1)\ \theta\ (A2)\to A3;\ A4\to PC$$

        注：四地址结构指令再 RISC 中很少会使用

    * 三地址结构指令

        | $$\theta$$ | A1 | A2 | A3 |
        :-: | :-: | :-: | :-: 
        操作码 | 操作数地址1 | 操作数地址2 | 结果地址

        功能：

        $$(A1)\ \theta\ (A2)\to A3;\ (PC)^+\to PC$$
        
        例：`ADD rd, rs, rt`

    * 二地址结构指令

        | $$\theta$$ | A1 | A2 |
        | :-: | :-: | :-: |
        | 操作码 | 目的地址 | 源地址 |

        功能：

        $$(A1)\ \theta\ (A2)\to A1;\ (PC)^+\to PC$$

        例：`ADD r1, r0`

    * 一地址结构指令

        | $$\theta$$ | A1 |
        | :-: | :-: |
        | 操作码 | 源 / 目的地址 |

        双操作数：

        $$A1\ \cup \ [PC]_H \to PC$$
        
        如：`J addr`

        单操作数：

        $$\theta\ (A1)\to A1;\ (PC)^+\to PC$$

        如：`INC R0`

    * 零地址结构指令

        | $$\theta$$ |
        | :-: |
        | 操作码 |

        功能：

        1. 用于处理机的特殊控制，如 HLT, NOP
        2. 针对隐含约定的寄存器，如返回指令 RST：

        $$(SP)\ \to \ PC;\ SP^+\ \to \ SP$$

## 指令可能会涉及到的操作数类型

1. 地址码数据：地址码

2. 数值型数据：定点数、浮点数

3. 字符型数据：ASCII

4. 逻辑型数据：二进制代码

## MIPS32 架构的指令格式

* RISC

* 指令字长：32

* 寄存器数量：32

# 指令中的寻址方式

## 常见寻址方式

1. 立即寻址(Immediate addressing)

    用来提供偏移量、常数、设置初值等

$$
指令中直接包含了操作数
\begin{cases}
定长格式 & 操作码\ \theta |\dots| 立即数\ I\\[3ex]
变长格式 & 基本操作 | 立即数\ I
\end{cases}
$$

2. 直接寻址

    数的地址如地址码所记录

$$
指令中直接给出操作数的地址码
\begin{cases}
存储单元地址 & M:\ 主存直接寻址 \\[3ex]
寄存器编号 & R:\ 寄存器直接寻址
\end{cases}
$$

3. 间接寻址

    指令中包含的地址所指向的区域，用于存储该数的真正地址。一般只在 CISC 中使用，RISC 中一般不用

$$
指令给出操作数的间接地址
\begin{cases}
存储单元地址 & M:\ 主存间接寻址 \\[3ex]
寄存器编号 & R:\ 寄存器间接寻址
\end{cases}
$$

